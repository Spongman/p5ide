{"version":3,"sources":["SourceLanguage.ts","MyReact.ts","utils.ts","project.tsx","monaco.ts","proxyConsole.ts","error.tsx","preview.ts","webProject.tsx","githubProject.tsx","auth.ts","index.ts"],"names":["SourceLanguage","[object Object]","name","extensions","icon","mimeType","this","extension","charAt","_languages","find","l","indexOf","Javascript","Typescript","Html","Css","exports","MyReact","createElement","tagName","attributes","children","element","document","key","Object","keys","value","startsWith","addEventListener","substr","toLowerCase","setAttribute","child","appendReactChild","promiseRequire","paths","Promise","resolve","reject","require","modules","err","String","prototype","trimStart","str","replace","length","trimEnd","endsWith","click","fn","getElementById","event","preventDefault","cachedFetch","url","window","caches","cache","open","response","match","fetch","put","localStorage","JSON","parse","stringify","EventDelayer","callback","delay","timeUpdate","setTimeout","timeRemaining","Date","now","startTimer","timeNow","searchParams","params","entries","reduce","a","k","v","append","URLSearchParams","parseUrl","href","protocol","hostname","host","port","pathname","hash","search","blobToString","blob","reader","FileReader","e","result","readAsText","ExtraLibs","libName","mapExtraLibs","dispose","content","console","log","disposable","monaco","languages","typescript","javascriptDefaults","addExtraLib","lib","ProjectNode","parent","_allowClick","renderElement","used","classList","contains","setUsed","toggle","selected","remove","activate","deleteNodeEvent","Event","bubbles","cancelable","sourceNode","target","dispatchEvent","delete","project","Error","input","querySelector","shaded","focus","readOnly","select","add","$this","onBlur","onChange","isValid","removeEventListener","onInput","style","outlineColor","test","ProjectFolder","childContainer","super","path","forEach","i","walk","ich","childName","rest","newNode","ProjectFile","addChild","startRename","removeChild","MyReact_1","class","title","onClick","onNewFile","bind","aria-hidden","onNewFolder","onDelete","readonly","clearUsed","push","appendChild","index","splice","Project","cwd","workingDirectory","parts","split","pop","part","childFolder","lastIndexOf","language","SourceLanguage_1","fromExtension","languageName","_languageName","getLanguages","id","model","Blob","getValue","type","utils_1","text","createModel","fetchModel","editor","Uri","openFileEvent","ImmortalReference","object","SimpleModel","_onDispose","Emitter","onDispose","as","textEditorModel","fire","SimpleEditorModelResolverService","resource","getEditorType","EditorType","ICodeEditor","findModel","diffEditor","getOriginalEditor","getModifiedEditor","simpleModel","scheme","provider","getModel","EditorService","_editor","options","sideBySide","setModel","selection","setSelection","top","getTopForLineNumber","startLineNumber","setScrollTop","getDomNode","clientHeight","alert","arguments","P5Editor","libs","fixedOverflowWidgets","fontFamily","lineNumbersMinChars","mouseWheelZoom","scrollBeyondLastLine","theme","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","setCompilerOptions","noLib","ScriptTarget","ES2016","allowNonTsExtensions","textModelResolverService","editorService","editorContainer","create","textModelService","setEditor","layout","pos","setPosition","newOptions","updateOptions","listener","onDidChangeCursorPosition","onDidChangeModelContent","onDidChangeModel","ProxyConsole","addRow","_this","prop","getOwnPropertyDescriptors","orig","override","apply","className","args","row","textContent","Array","slice","call","map","toString","join","message","optionalParams","addSimpleRow","PreviewError","app","currentProject","origin","currentTarget","location","local","filename","fileText","lineno","colno","MyReact_2","error","stack","loadFile","lineNumber","column","_previewPage","P5Preview","application","isDocked","isPaused","isLoading","previousScript","_currentHtml","previewFile","currentHtml","file","utils_2","loadPreview","writePreview","docked","previewContainer","innerHTML","previewFrame","src","rect","getBoundingClientRect","pr","devicePixelRatio","Math","floor","clientWidth","screenX","left","screenY","interval","setInterval","closed","clearInterval","body","frame","contentWindow","loopProtect","alias","protect","sw","navigator","serviceWorker","handleRequest","root","register","scope","reg","ready","html","fetchValue","base","__awaiter","ports","originalUrl","data","originLength","substring","node","project_1","postMessage","redirect","status","statusText","SourceLanguage_2","currentFile","fetchBlob","clear","write","close","previewWindow","handlePreviewError","consoleContainer","proxyConsole_1","scroll","scrollTop","scrollHeight","setConsoleVisibility","control","error_1","render","show","found","styleSheets","filter","ss","linkNode","ownerNode","paused","WebProject","project_2","branchResponse","urlParts","utils_3","item","WebFile","ok","info","addParents","GitHubProject","project_3","user","repo","branch","sha","branchJson","utils_4","json","commit","treeJson","tree","addFile","GitHubFile","Auth","authenticated","token","access_token","authenticate","fetchToken","userJson","method","headers","Authorization","userName","login","width","height","menubar","toolbar","personalbar","screenLeft","innerWidth","screenTop","innerHeight","loginWindow","onMessage","code","loginJson","get","_auth","auth_1","Application","githubProject_1","load","webProject_1","createTextNode","project_4","Node","grandChild","fileContainer","closeFile","preview","li","sourceEvent","defaultFile","SourceLanguage_3","utils_5","position","f","values","all","then","initialize","monaco_1","preview_1","loadProjectFromUrl","uri","_delayer","trigger","loadProject","pause","openDialog","selectTheme","setTheme","querySelectorAll","opt","span","parentNode","fixed","before","childNodes","horizontal","onMove","pageX","right","pageY","bottom","elt","display","form","urlElement","activeElement","elements","namedItem","setCustomValidity","reportValidity","paddingLeft","paddingTop"],"mappings":"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","file":"index.js","sourcesContent":["export class SourceLanguage {\n\tconstructor(public name: string, public extensions: string[], public icon: string = \"file-o\", public mimeType: string = \"text/\" + name) { }\n\tstatic Javascript = new SourceLanguage(\"javascript\", [\".js\"], \"file-text-o\");\n\tstatic Typescript = new SourceLanguage(\"typescript\", [\".ts\"], \"file-text-o\");\n\tstatic Html = new SourceLanguage(\"html\", [\".html\"], \"file-code-o\");\n\tstatic Css = new SourceLanguage(\"css\", [\".css\"], \"file-text-o\");\n\tprivate static _languages = [\n\t\tSourceLanguage.Javascript,\n\t\tSourceLanguage.Typescript,\n\t\tSourceLanguage.Html,\n\t\tSourceLanguage.Css,\n\t];\n\tstatic fromExtension(extension: string): SourceLanguage | undefined {\n\t\tif (extension.charAt(0) !== '.')\n\t\t\textension = '.' + extension;\n\t\treturn SourceLanguage._languages.find(l => l.extensions.indexOf(extension) >= 0);\n\t}\n}","\nexport namespace MyReact {\n\n\texport function createElement(tagName: string, attributes: AttributeCollection | null, ...children: any[]): Element {\n\t\tconst element = document.createElement(tagName);\n\n\t\tif (attributes) {\n\t\t\tfor (const key of Object.keys(attributes)) {\n\t\t\t\tconst value = attributes[key];\n\t\t\t\tif (key.startsWith(\"on\") && typeof value === 'function')\n\t\t\t\t\telement.addEventListener(key.substr(2).toLowerCase(), value);\n\t\t\t\telse\n\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t}\n\t\t}\n\n\t\tfor (const child of children)\n\t\t\tappendReactChild(element, child);\n\n\t\treturn element;\n\t}\n}\n","import { ProjectNode } from \"./project\";\n\n\nexport interface Document {\n\tready(): Promise<any>;\n}\n\ninterface Function {\n\tcall<T>(this: (...args: any[]) => T, thisArg: any, ...argArray: any[]): T;\n}\n\n\nexport function promiseRequire(paths: string[]): Promise<any[]> {\n\treturn new Promise((resolve, reject) => {\n\t\trequire(paths, (...modules: any[]) => resolve(modules), (err: RequireError) => reject(err));\n\t});\n}\n\ndeclare interface String {\n\ttrimStart(str?: string): string;\n\ttrimEnd(str?: string): string;\n}\n\ndeclare global {\n\tinterface String {\n\t\ttrimStart(str?: string):string;\n\t\ttrimEnd(str?: string):string;\n\t}\n}\n\nString.prototype.trimStart = function (str?: string) {\n\tif (typeof str === 'undefined')\n\t\treturn this.replace(/^\\s+/, '');\n\tif (this.startsWith(str))\n\t\treturn this.substr(str.length);\n\treturn this as string;\n};\n\nString.prototype.trimEnd = function (str?: string) {\n\tif (typeof str === 'undefined')\n\t\treturn this.replace(/\\s+$/, '');\n\tif (this.endsWith(str))\n\t\treturn this.substr(0, this.length - str.length);\n\treturn this as string;\n};\n/*\nfunction promiseEvent(elt: HTMLElement, type: string): Promise<Event> {\n\treturn new Promise(function (resolve) {\n\t\tfunction handle(event: Event) {\n\t\t\tconsole.log(\"HANDLE\", type);\n\t\t\telt.removeEventListener(type, handle);\n\t\t\tresolve(event);\n\t\t}\n\t\telt.addEventListener(type, handle);\n\t});\n}\n*/\n\nexport function click(element: HTMLElement | string, fn: (event: MouseEvent) => any) {\n\tif (typeof element === 'string')\n\t\telement = document.getElementById(element)!;\n\telement.addEventListener(\"click\", event => {\n\t\tevent.preventDefault();\n\t\tfn(event);\n\t});\n}\n\nexport async function cachedFetch(url: string): Promise<Response> {\n\n\tif (window.caches) {\n\t\tconst cache = await window.caches.open(\"fetch\");\n\t\t//console.log(\"CACHE\", cache);\n\t\tlet response = await cache.match(url);\n\t\t//console.log(\"MATCH\", response);\n\t\tif (!response) {\n\t\t\tresponse = await fetch(url);\n\t\t\t//console.log(\"FETCH\", response);\n\t\t\tawait cache.put(url, response);\n\t\t\tresponse = await cache.match(url);\n\t\t\t//console.log(\"MATCH\", response);\n\t\t}\n\t\treturn response;\n\t}\n\telse if (window.localStorage) {\n\n\t\tif (!window.localStorage.fetch)\n\t\t\twindow.localStorage.fetch = {};\n\n\t\tlet response: Response = JSON.parse(window.localStorage.fetch[url]);\n\t\tif (!response) {\n\t\t\tresponse = await fetch(url);\n\t\t\twindow.localStorage.fetch[url] = JSON.stringify(response);\n\t\t}\n\t\treturn response;\n\t}\n\telse {\n\t\treturn fetch(url);\n\t}\n}\n\n\nexport class EventDelayer {\n\n\tconstructor(private callback: () => void, private delay: number) {\n\t}\n\n\tprivate timeUpdate: number = 0;\n\n\tprivate startTimer(delay: number) {\n\t\tsetTimeout(() => {\n\n\t\t\tconst timeRemaining = this.timeUpdate - Date.now();\n\t\t\tif (timeRemaining > 0) {\n\t\t\t\tthis.startTimer(timeRemaining);\n\t\t\t} else {\n\t\t\t\tthis.timeUpdate = 0;\n\t\t\t\tthis.callback();\n\t\t\t}\n\n\t\t}, this.delay);\n\t}\n\n\ttrigger() {\n\t\tconst timeNow = Date.now();\n\t\tif (!this.timeUpdate)\n\t\t\tthis.startTimer(this.delay);\n\t\tthis.timeUpdate = timeNow + this.delay;\n\t}\n}\n\nexport interface SourceNodeEvent extends Event {\n\tsourceNode: ProjectNode;\n}\n\nexport function searchParams(params: Object) {\n\treturn Object.entries(params).reduce((a, [k, v]) => { return a.append(k, v), a; }, new URLSearchParams());\n}\n\nexport function parseUrl(url: string) {\n\tconst l = document.createElement(\"a\") as HTMLAnchorElement;\n\tl.href = url;\n\treturn {\n\t\tprotocol: l.protocol.trimEnd(\":\"),\n\t\thostname: l.hostname,\n\t\thost: l.host,\n\t\tport: l.port,\n\t\tpathname: l.pathname.trimStart(\"/\"),\n\t\thash: l.hash,\n\t\tsearch: l.search,\n\t};\n}\n\n\nexport function blobToString(blob: Blob): Promise<string> {\n\treturn new Promise<string>((resolve, reject) => {\n\t\tconst reader = new FileReader();\n\t\treader.addEventListener('loadend', e => resolve(reader.result));\n\t\treader.addEventListener('error', reject);\n\t\treader.addEventListener('abort', reject);\n\t\treader.readAsText(blob);\n\t});\n}\n\n\n\nexport class ExtraLibs {\n\n\tprivate static mapExtraLibs: { [name: string]: monaco.IDisposable } = {};\n\n\tpublic static dispose() {\n\t\t//console.log(\"DISPOSE LIBS\", name);\n\t\tfor (const libName in this.mapExtraLibs)\n\t\t\tthis.mapExtraLibs[libName].dispose();\n\t\tthis.mapExtraLibs = {};\n\t}\n\n\tpublic static add(name: string, content: string) {\n\t\tif (this.mapExtraLibs[name])\n\t\t\treturn;\n\t\tconsole.log(\"ADD EXTRA LIB\", name);\n\t\tconst disposable = monaco.languages.typescript.javascriptDefaults.addExtraLib(content, name);\n\t\tthis.mapExtraLibs[name] = disposable;\n\t}\n\n\tpublic static remove(name: string) {\n\t\tconst lib = this.mapExtraLibs[name];\n\t\tif (lib) {\n\t\t\tlib.dispose();\n\t\t\tdelete this.mapExtraLibs[name];\n\t\t}\n\t}\n}","import { SourceLanguage } from \"./SourceLanguage\";\nimport { MyReact } from \"./MyReact\";\nimport { SourceNodeEvent, blobToString } from \"./utils\";\n\nexport abstract class ProjectNode implements monaco.IDisposable, IProjectNode {\n\n\tconstructor(public name: string, public icon: string) {\n\t\tthis.element = this.renderElement();\n\t}\n\tparent: ProjectFolder | null = null;\n\treadonly element: HTMLElement;\n\n\tabstract get path(): string;\n\n\tget used(): boolean { return !!this.element && this.element.classList.contains(\"used\"); }\n\tset used(value: boolean) { this.setUsed(value); }\n\n\tclearUsed() { this.used = false }\n\n\tprotected setUsed(value: boolean) {\n\t\tif (value && this.parent)\n\t\t\tthis.parent.used = true;\n\t\tif (this.element)\n\t\t\tthis.element.classList.toggle(\"used\", value);\n\t}\n\n\tget selected(): boolean {\n\t\treturn this.element.classList.contains(\"selected\");\n\t}\n\tset selected(value: boolean) {\n\t\tthis.element.classList.toggle(\"selected\", value);\n\t}\n\n\tprotected abstract renderElement(): HTMLElement;\n\n\tabstract dispose(): void;\n\tdelete() {\n\t\tthis.dispose();\n\t\tif (this.element)\n\t\t\tthis.element.remove();\n\t}\n\n\tprotected _allowClick = true;\n\n\tprotected onClick(event: Event) {\n\t\tevent.preventDefault();\n\t\tif (this._allowClick)\n\t\t\tthis.activate();\n\t}\n\n\tprotected onDelete(event: Event) {\n\t\tevent.preventDefault();\n\n\t\tlet deleteNodeEvent = new Event(\"p5ide_deleteNode\", {\n\t\t\tbubbles: true,\n\t\t\tcancelable: true,\n\t\t}) as SourceNodeEvent;\n\t\tdeleteNodeEvent.sourceNode = this;\n\t\tif (event.target && event.target.dispatchEvent(deleteNodeEvent)) {\n\t\t\tthis.delete();\n\t\t}\n\t}\n\n\tget project(): Project | null { return this.parent && this.parent.project; }\n\n\tabstract activate(): void;\n\n\tasync startRename(): Promise<boolean> {\n\t\tif (!this.project)\n\t\t\tthrow new Error(\"uninitialized\");\n\n\t\tvar input = this.element.querySelector(\".inputWrapper input\") as HTMLInputElement;\n\t\tif (!input)\n\t\t\tthrow new Error(\"input not found\");\n\n\t\tthis._allowClick = false;\n\t\tthis.project.shaded = true;\n\t\tinput.focus();\n\t\tinput.readOnly = false;\n\t\tinput.select();\n\t\tthis.element.classList.add('unshaded');\n\n\t\tvar $this = this;\n\n\t\tvar result = await new Promise<boolean>((resolve, reject) => {\n\n\t\t\tfunction done(value: boolean) {\n\t\t\t\tinput.removeEventListener('blur', onBlur);\n\t\t\t\tinput.removeEventListener('input', onInput);\n\t\t\t\tinput.removeEventListener('change', onChange);\n\t\t\t\tinput.readOnly = true;\n\t\t\t\t$this._allowClick = true;\n\t\t\t\t$this.project!.shaded = false;\n\t\t\t\t$this.element.classList.remove('unshaded');\n\t\t\t\tinput.style.outlineColor = '';\n\t\t\t\tresolve(value);\n\t\t\t}\n\n\t\t\tfunction onBlur(event: Event) {\n\t\t\t\t//done(false);\n\t\t\t}\n\n\t\t\tfunction onChange(event: Event) {\n\t\t\t\tif (isValid()) {\n\t\t\t\t\t$this.name = input.value;\n\t\t\t\t\tdone(true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onInput(event: Event) {\n\t\t\t\tinput.style.outlineColor = isValid() ? '' : 'red';\n\t\t\t}\n\n\t\t\tfunction isValid() {\n\t\t\t\treturn /^[a-z0-9_.-]*$/.test(input.value);\n\t\t\t}\n\n\t\t\tinput.addEventListener('blur', onBlur);\n\t\t\tinput.addEventListener('input', onInput);\n\t\t\tinput.addEventListener('change', onChange);\n\t\t});\n\n\t\treturn result;\n\t}\n}\n\nexport class ProjectFolder extends ProjectNode implements IProjectFolder {\n\n\tconstructor(name: string) {\n\t\tsuper(name, \"folder-o\");\n\n\t\tvar childContainer;\n\t\tif (this.element.classList.contains(\"childContainer\"))\n\t\t\tchildContainer = this.element;\n\t\telse {\n\t\t\tchildContainer= this.element.querySelector(\".childContainer\") as HTMLElement;\n\t\t\tif (!childContainer)\n\t\t\t\tthrow new Error(\"childContainer not found\");\n\t\t}\n\t\tthis.childContainer = childContainer;\n\t}\n\n\treadonly children: ProjectNode[] = [];\n\tprotected childContainer: HTMLElement;\n\n\tget path(): string {\n\t\tlet parentPath = this.parent ? this.parent.path : \"/\";\n\t\treturn parentPath + this.name + \"/\";\n\t}\n\n\tdispose(): void {\n\t\tthis.children.forEach(i => i.dispose());\n\t}\n\n\tdelete() {\n\t\tthis.children.forEach(i => i.delete());\n\t\tsuper.delete();\n\t\tthis.children.length = 0;\n\t}\n\n\twalk(callback:(node:ProjectNode) => any):any {\n\t\tfor (var child of this.children) {\n\t\t\tvar result = callback(child);\n\t\t\tif (result != null)\n\t\t\t\treturn result;\n\t\t\tif (child instanceof ProjectFolder) {\n\t\t\t\tresult = child.walk(callback);\n\t\t\t\tif (result != null)\n\t\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t}\n\n\tfind(path: string): ProjectNode | undefined {\n\n\t\tif (!path)\n\t\t\treturn void 0;\n\n\t\tpath = path.trimStart('/');\n\n\t\tlet ich = path.indexOf('/');\n\t\tif (ich < 0)\n\t\t\tich = path.length;\n\n\t\tlet childName = path.substr(0, ich);\n\t\tlet child = (childName === \"..\") ? this.parent : this.children.find(i => i.name === childName) as ProjectFolder;\n\t\tif (!child)\n\t\t\treturn void 0;\n\n\t\tlet rest = path.substr(ich + 1);\n\t\treturn rest ? child.find(rest) : child;\n\t}\n\n\tactivate() {\n\t\tthis.element.classList.toggle(\"open\");\n\t}\n\n\tasync onNewFile(event: Event) {\n\t\tthis.open = true;\n\t\tvar newNode = new ProjectFile('');\n\t\tthis.addChild(newNode);\n\t\tif (await newNode.startRename()) {\n\t\t\tnewNode.activate();\n\t\t} else {\n\t\t\tthis.removeChild(newNode);\n\t\t}\n\t}\n\n\tasync onNewFolder(event: Event) {\n\t\tthis.open = true;\n\t\tvar newNode = new ProjectFolder('');\n\t\tthis.addChild(newNode);\n\t\tif (await newNode.startRename()) {\n\t\t\tnewNode.activate();\n\t\t} else {\n\t\t\tthis.removeChild(newNode);\n\t\t}\n\t}\n\n\trenderElement() {\n\t\treturn (\n\t\t\t<li class=\"sourceNode\">\n\t\t\t\t<div class=\"hover\">\n\t\t\t\t\t<div class=\"hover-show\">\n\t\t\t\t\t\t<a href=\"#\" title=\"new file\" onClick={this.onNewFile.bind(this)} >\n\t\t\t\t\t\t\t<i class=\"fa fa-file-o\" aria-hidden=\"true\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-plus fa-overlay\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a href=\"#\" title=\"new folder\" onClick={this.onNewFolder.bind(this)} >\n\t\t\t\t\t\t\t<i class=\"fa fa-folder-o\" aria-hidden=\"true\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-plus fa-overlay\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a href=\"#\" title={\"delete \" + this.name} onClick={this.onDelete.bind(this)} >\n\t\t\t\t\t\t\t<i class=\"fa fa-trash-o\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href=\"#\" onClick={this.onClick.bind(this)}>\n\t\t\t\t\t\t<i class=\"icon fa fa-folder-o\"></i>\n\t\t\t\t\t\t<i class=\"icon fa fa-folder-open-o\"></i>\n\t\t\t\t\t\t<div class=\"inputWrapper\">\n\t\t\t\t\t\t\t<input readonly=\"readonly\" value={this.name}></input>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<ul class=\"childContainer\">\n\t\t\t\t\t{this.children}\n\t\t\t\t</ul>\n\t\t\t</li>\n\t\t);\n\t}\n\n\tset used(value: boolean) {\n\t\tsuper.setUsed(value);\n\t\tif (value && this.name !== 'libraries') {\n\t\t\tthis.open = value;\n\t\t}\n\t}\n\n\tclearUsed() {\n\t\tsuper.clearUsed();\n\t\tthis.open = false;\n\t\tfor (var child of this.children)\n\t\t\tchild.clearUsed();\n\t}\n\n\tget open(): boolean {\n\t\treturn this.element.classList.contains(\"open\");\n\t}\n\tset open(value: boolean) {\n\t\tif (this.element)\n\t\t\tthis.element.classList.toggle(\"open\", value);\n\t\tif (value && this.parent)\n\t\t\tthis.parent.open = true;\n\t}\n\n\taddChild(child: ProjectNode) {\n\t\tchild.parent = this;\n\t\tthis.children.push(child);\n\t\tthis.childContainer.appendChild(child.element);\n\t}\n\tremoveChild(child: ProjectNode) {\n\t\tvar index = this.children.indexOf(child);\n\t\tif (index < 0)\n\t\t\tthrow new Error(\"not a child of this node\");\n\t\tchild.parent = null;\n\t\tthis.children.splice(index, 1);\n\t\tif (child.element)\n\t\t\tthis.childContainer.removeChild(child.element);\n\t}\n}\n\n\nexport abstract class Project\n\textends ProjectFolder\n\timplements monaco.IDisposable, IProject {\n\n\tconstructor(cwd: string = \"\") {\n\t\tsuper(\"\");\n\n\t\tthis.workingDirectory = this.find(cwd) as ProjectFolder || this;\n\t}\n\n\trenderElement() {\n\t\treturn (\n\t\t\t<ul class=\"childContainer\">{this.children}</ul>\n\t\t);\n\t}\n\n\tget project() { return this; }\n\tget path() { return \"/\"; }\n\n\tasync loadFile(url: string): Promise<ProjectFile | undefined> { return; }\n\n\tfind(path: string): ProjectNode | undefined {\n\t\tif (this.workingDirectory &&\n\t\t\tthis.workingDirectory !== this &&\n\t\t\t!path.startsWith(\"/\")) {\n\t\t\treturn this.workingDirectory.find(path);\n\t\t}\n\t\treturn super.find(path);\n\t}\n\n\tworkingDirectory: ProjectFolder;\n\n\tprotected addParents(path: string) {\n\n\t\tif (path.startsWith(\"/\")) {\n\t\t\tpath = path.trimStart(\"/\");\n\t\t}\n\t\telse if (path.startsWith(\"./\")) {\n\t\t\tpath = this.workingDirectory.path + path.substr(1);\n\t\t}\n\t\telse if (!path.startsWith(this.path))\n\t\t\treturn;\n\n\t\tlet parent = this as ProjectFolder;\n\t\tlet parts = path.split('/');\n\t\tlet name = parts.pop();\n\t\tif (!name)\n\t\t\treturn;\n\n\t\tfor (let part of parts) {\n\t\t\tlet childFolder = parent.find(part) as ProjectFolder;\n\t\t\tif (!childFolder) {\n\t\t\t\tchildFolder = new ProjectFolder(part);\n\t\t\t\tparent.addChild(childFolder);\n\t\t\t}\n\n\t\t\tparent = childFolder;\n\t\t}\n\n\t\treturn {\n\t\t\tname: name,\n\t\t\tparent: parent,\n\t\t}\n\t}\n\n\tget shaded(): boolean { return this.element.classList.contains(\"shaded\"); }\n\tset shaded(value: boolean) {\n\t\tthis.element.classList.toggle(\"shaded\", value);\n\t}\n}\n\n\nexport class ProjectFile\n\textends ProjectNode\n\timplements IProjectFile {\n\n\tconstructor(name: string) {\n\n\t\tsuper(name, \"file-text-o\");\n\n\t\tconst ich = this.name.lastIndexOf('.');\n\t\tif (ich >= 0)\n\t\t\tthis.extension = this.name.substr(ich);\n\t\telse\n\t\t\tthis.extension = \"\";\n\n\t\tthis.language = SourceLanguage.fromExtension(this.extension);\n\n\t\tif (this.language)\n\t\t\tthis.icon = this.language.icon;\n\t}\n\n\tget path() {\n\t\tlet parentPath = this.parent ? this.parent.path : \"/\";\n\t\treturn parentPath + this.name;\n\t}\n\n\tlanguage?: SourceLanguage;\n\textension: string;\n\n\tprivate _languageName: string | undefined;\n\tget languageName() {\n\t\tif (typeof this._languageName === 'undefined') {\n\t\t\tif (this.language)\n\t\t\t\tthis._languageName = this.language.name;\n\t\t\telse {\n\t\t\t\tlet l = monaco.languages.getLanguages().find(l => l.extensions ? l.extensions.indexOf(this.extension) >= 0 : false);\n\t\t\t\tif (l)\n\t\t\t\t\tthis._languageName = l.id;\n\t\t\t}\n\t\t}\n\t\treturn this._languageName;\n\t}\n\n\tprotected async fetch(): Promise<Response> {\n\t\treturn await fetch(\"assets/default/\" + this.path);\n\t}\n\n\tmodel?: monaco.editor.IModel;\n\tblob?: Blob;\n\n\tasync fetchBlob(): Promise<Blob> {\n\t\tif (this.model)\n\t\t\treturn new Blob([this.model.getValue()], { type: this.language && this.language.mimeType });\n\n\t\tif (!this.blob) {\n\t\t\tlet response = await this.fetch();\n\t\t\tthis.blob = await response.blob();\n\t\t}\n\t\treturn this.blob;\n\t}\n\n\tasync fetchModel(): Promise<monaco.editor.IModel> {\n\n\t\tif (!this.model) {\n\t\t\tlet content: string;\n\t\t\tif (this.blob) {\n\t\t\t\tcontent = await blobToString(this.blob);\n\t\t\t\tdelete this.blob;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet response = await this.fetch();\n\t\t\t\tcontent = await response.text();\n\t\t\t}\n\t\t\tthis.model = this.createModel(content);\n\t\t}\n\t\treturn this.model;\n\t}\n\n\tasync fetchValue(): Promise<string> {\n\t\tlet model = await this.fetchModel();\n\t\treturn model.getValue();\n\t}\n\n\t/*\n\tprotected async fetch(): Promise<string> {\n\t\tlet response = await fetch(\"/assets/default/\" + this.path);\n\t\tlet content = await response.text();\n\t\tlet model = this.createModel(content);\n\t\treturn model.getValue();\n\t}\n\t*/\n\n\tprotected createModel(content: string) {\n\t\tif (!this.model)\n\t\t\tthis.model = monaco.editor.createModel(content, this.languageName, monaco.Uri.parse(this.path));\n\t\treturn this.model;\n\t}\n\n\tdispose(): void {\n\t\tif (this.model) {\n\t\t\tthis.model.dispose();\n\t\t\tdelete this.model;\n\t\t}\n\t}\n\n\tactivate() {\n\t\tlet openFileEvent = new Event(\"p5ide_openFile\", {\n\t\t\tbubbles: true,\n\t\t}) as SourceNodeEvent;\n\t\topenFileEvent.sourceNode = this;\n\t\tthis.element.dispatchEvent(openFileEvent);\n\t}\n\n\trenderElement() {\n\t\treturn (\n\t\t\t<li class=\"sourceNode\">\n\t\t\t\t<div class=\"hover\">\n\t\t\t\t\t<div class=\"hover-show\">\n\t\t\t\t\t\t<a href=\"#\" onClick={this.onDelete.bind(this)} title={\"delete \" + this.name}>\n\t\t\t\t\t\t\t<i class=\"fa fa-trash-o\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href=\"#\" onClick={this.onClick.bind(this)}>\n\t\t\t\t\t\t<i class={`icon fa fa-${this.icon}`}></i>\n\t\t\t\t\t\t<div class=\"inputWrapper\">\n\t\t\t\t\t\t\t<input readonly=\"readonly\" value={this.name}></input>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t);\n\t}\n}\n","\n\nclass ImmortalReference<T> {\n\tconstructor(public readonly object: T) { }\n\tdispose(): void { }\n}\n\n\nclass SimpleModel {\n\n\tprivate readonly _onDispose: monaco.Emitter<void>;\n\n\tconstructor(private readonly model: monaco.editor.IModel) {\n\t\tthis._onDispose = new monaco.Emitter<void>();\n\t}\n\n\tpublic get onDispose(): monaco.IEvent<void> {\n\t\treturn this._onDispose.event;\n\t}\n\n\tpublic load(): monaco.Promise<SimpleModel> {\n\t\treturn monaco.Promise.as(this);\n\t}\n\n\tpublic get textEditorModel(): monaco.editor.IModel {\n\t\treturn this.model;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._onDispose.fire();\n\t}\n}\n\nclass SimpleEditorModelResolverService {\n\n\tprivate editor: monaco.editor.IEditor | undefined;\n\n\tpublic setEditor(editor: monaco.editor.IEditor): void {\n\t\tthis.editor = editor;\n\t}\n\n\tpublic createModelReference(resource: monaco.Uri): monaco.Promise<ImmortalReference<SimpleModel | null>> {\n\n\t\tif (!this.editor)\n\t\t\tthrow new Error(\"not editor set yet\");\n\n\t\tlet model: monaco.editor.IModel | null;\n\t\tif (this.editor.getEditorType() === monaco.editor.EditorType.ICodeEditor)\n\t\t\tmodel = this.findModel(this.editor, resource);\n\t\telse {\n\t\t\tconst diffEditor = this.editor as monaco.editor.IDiffEditor;\n\t\t\tmodel = this.findModel(diffEditor.getOriginalEditor(), resource) || this.findModel(diffEditor.getModifiedEditor(), resource);\n\t\t}\n\t\tconst simpleModel = model ? new SimpleModel(model) : null;\n\t\treturn monaco.Promise.as(new ImmortalReference(simpleModel));\n\t}\n\n\tpublic registerTextModelContentProvider(scheme: string, provider: any): monaco.IDisposable {\n\t\treturn new ImmortalReference(null);\n\t}\n\n\tprivate findModel(editor: monaco.editor.IEditor, resource: monaco.Uri): monaco.editor.IModel {\n\t\t//return editor.getModel(resource);\n\t\treturn editor.getModel() as monaco.editor.IModel;\n\t}\n}\n\nclass EditorService {\n\n\tprivate _editor: monaco.editor.IStandaloneCodeEditor | undefined;\n\n\tsetEditor(editor: monaco.editor.IStandaloneCodeEditor) {\n\t\tthis._editor = editor;\n\t}\n\n\topenEditor(options: any, sideBySide: boolean) {\n\t\tconst model = monaco.editor.getModel(options.resource.path);\n\t\tif (!model)\n\t\t\treturn monaco.Promise.as(null);\n\t\tif (!this._editor)\n\t\t\tthrow new Error(\"no editor set yet\");\n\t\tthis._editor.setModel(model);\n\t\tif (options.options.selection) {\n\t\t\tthis._editor.setSelection(options.options.selection);\n\t\t\tconst top = this._editor.getTopForLineNumber(options.options.selection.startLineNumber);\n\t\t\tthis._editor.setScrollTop(top - this._editor.getDomNode().clientHeight * 2 / 5);//.setScrollPosition(200);\n\t\t}\n\t\tthis._editor.focus();\n\t\treturn monaco.Promise.as(null);\n\t};\n\n\tresolveEditor() {\n\t\talert(`resolve editor called!` + JSON.stringify(arguments));\n\t}\n}\n\ndeclare interface IPreloadLibrary {\n\ttext: string;\n\turl: string;\n}\n\nexport class P5Editor {\n\n\tpublic _editor: monaco.editor.IStandaloneCodeEditor;\n\tpublic options: monaco.editor.IEditorConstructionOptions = {\n\t\tfixedOverflowWidgets: true,\n\t\tfontFamily: 'Fira Code',\n\t\t//fontLigatures: true,\n\t\t//glyphMargin: false,\n\t\tlineNumbersMinChars: 3,\n\t\tmouseWheelZoom: true,\n\t\tscrollBeyondLastLine: false,\n\t\t//useTabStops: true,\n\t\t//renderIndentGuides: true,\n\t\ttheme: 'vs-dark',\n\t};\n\n\tconstructor(libs: IPreloadLibrary[]) {\n\n\t\t// validation settings\n\t\tmonaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({\n\t\t\tnoSemanticValidation: false,\n\t\t\tnoSyntaxValidation: false\n\t\t});\n\n\t\t// compiler options\n\t\tmonaco.languages.typescript.javascriptDefaults.setCompilerOptions({\n\t\t\tnoLib: true,\n\t\t\ttarget: monaco.languages.typescript.ScriptTarget.ES2016,\n\t\t\tallowNonTsExtensions: true\n\t\t});\n\n\t\tconst textModelResolverService = new SimpleEditorModelResolverService();\n\t\tconst editorService = new EditorService();\n\n\n\t\tconst editorContainer = document.getElementById('editorContainer')!;\n\t\tthis._editor = monaco.editor.create(\n\t\t\teditorContainer, this.options, {\n\t\t\t\teditorService: editorService,\n\t\t\t\ttextModelService: textModelResolverService,\n\t\t\t});\n\n\t\ttextModelResolverService.setEditor(this._editor);\n\t\teditorService.setEditor(this._editor);\n\n\n\t\tlibs.forEach((lib, i: number) => {\n\t\t\tconsole.log(\"addExtraLib: \" + lib.url);\n\t\t\tmonaco.languages.typescript.javascriptDefaults.addExtraLib(lib.text, lib.url);\n\t\t});\n\t\tlibs.forEach((lib, i: number) => {\n\t\t\tmonaco.editor.createModel(lib.text, \"typescript\", monaco.Uri.parse(lib.url));\n\t\t});\n\n\t}\n\n\tlayout() { this._editor.layout(); }\n\tgetValue() { return this._editor.getValue(); }\n\tgetModel() { return this._editor.getModel(); }\n\tsetModel(model: monaco.editor.IModel) { this._editor.setModel(model); }\n\n\tsetPosition(pos: monaco.IPosition) {\n\t\tthis._editor.setPosition(pos);\n\t\tthis._editor.focus();\n\t} \n\tupdateOptions(newOptions: monaco.editor.IEditorOptions) { this._editor.updateOptions(newOptions); }\n\n\tonDidChangeCursorPosition(listener: (e: monaco.editor.ICursorPositionChangedEvent) => void) {\n\t\treturn this._editor.onDidChangeCursorPosition(listener);\n\t}\n\tonDidChangeModelContent(listener: (e: monaco.editor.IModelContentChangedEvent) => void) {\n\t\treturn this._editor.onDidChangeModelContent(listener);\n\t}\n\tonDidChangeModel(listener: (e: monaco.editor.IModelChangedEvent) => void) {\n\t\treturn this._editor.onDidChangeModel(listener);\n\t}\n}","export class ProxyConsole {\n\n\tconstructor(console: any, protected addRow: (elt: HTMLElement) => void) {\n\t\tconst _this: any = this;\n\t\tfor (const prop in Object.getOwnPropertyDescriptors(ProxyConsole.prototype)) {\n\t\t\tconst orig: Function = console[prop];\n\t\t\tconst override: Function = _this[prop];\n\t\t\tconsole[prop] = function () {\n\t\t\t\toverride.apply(_this, arguments);\n\t\t\t\torig.apply(this, arguments);\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate addSimpleRow(className: string, args: IArguments) {\n\t\tconst row = document.createElement(\"div\");\n\t\trow.className = className;\n\t\trow.textContent = Array.prototype.slice.call(args).map((a: any) => a.toString()).join(\" \");\n\t\tthis.addRow(row);\n\t}\n\n\t/*\n\tassert(test?: boolean, message?: string, ...optionalParams: any[]): void;\n\tclear(): void;\n\tcount(countTitle?: string): void;\n\tdebug(message?: any, ...optionalParams: any[]): void;\n\t*/\n\tdebug(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-debug\", arguments); }\n\t/*\n\tdir(value?: any, ...optionalParams: any[]): void;\n\tdirxml(value: any): void;\n\tgroup(groupTitle?: string): void;\n\tgroupCollapsed(groupTitle?: string): void;\n\tgroupEnd(): void;\n\tmsIsIndependentlyComposed(element: Element): boolean;\n\tprofile(reportName?: string): void;\n\tprofileEnd(): void;\n\tselect(element: Element): void;\n\ttable(...data: any[]): void;\n\ttime(timerName?: string): void;\n\ttimeEnd(timerName?: string): void;\n\t*/\n\tlog(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-log\", arguments); }\n\tinfo(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-info\", arguments); }\n\twarn(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-warn\", arguments); }\n\t/*\n\ttrace(message?: any, ...optionalParams: any[]): void;\n\t*/\n\terror(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-error\", arguments); }\n\t/*\n\texception(message?: string, ...optionalParams: any[]): void;\n\t*/\n}\n\n","import { MyReact } from \"./MyReact\";\n\nexport class PreviewError {\n\tproject: IProject;\n\tconstructor(public app:IApplication, public event: ErrorEvent) {\n\t\tthis.project = app.currentProject;\n\t}\n\n\t//private element: HTMLElement;\n\n\trender() {\n\n\t\tlet event = this.event;\n\t\tlet previewWindow = event.currentTarget as Window;\n\t\tconst origin = previewWindow.location.origin;\n\t\tconst local = event.filename.startsWith(origin);\n\t\tlet filename = local ? event.filename.substr(origin.length) : event.filename;\n\t\tfilename = filename.trimStart('/');\n\t\tconst fileText = `${filename}(${event.lineno},${event.colno})`;\n\n\t\tlet onClick = () => {\n\t\t\tthis.app.loadFile(\n\t\t\t\tthis.project.find(filename) as IProjectFile,\n\t\t\t\t{ lineNumber: event.lineno, column: event.colno }\n\t\t\t);\n\t\t\treturn false;\n\t\t};\n\n\t\treturn (\n\t\t\t<div class=\"error\">\n\t\t\t\t{\n\t\t\t\t\tevent.error && event.error.stack &&\n\t\t\t\t\t<i class=\"fa fa-info-circle\" title={event.error.stack}></i>\n\t\t\t\t}\n\t\t\t\t{\n\t\t\t\t\tlocal ?\n\t\t\t\t\t\t<a href=\"#\" onClick={onClick}>{fileText}</a>\n\t\t\t\t\t\t:\n\t\t\t\t\t\t<span>{fileText}</span>\n\t\t\t\t}\n\t\t\t\t<span> : {event.message}</span>\n\t\t\t</div>\n\t\t);\n\t}\n}\n","import { ExtraLibs } from './utils';\nimport { ProxyConsole } from './proxyConsole';\nimport { SourceLanguage } from \"./SourceLanguage\";\nimport { PreviewError } from './error';\nimport { P5Editor } from './monaco';\nimport { ProjectFolder, ProjectFile } from './project';\n\nconst _previewPage = \"assets/v/blank.html\";\n\nexport class P5Preview {\n\n\tprivate window: Window | null = null;\n\tprivate isDocked = true;\n\tprivate isPaused = false;\n\tprivate isLoading = false;\n\n\tprivate previousScript: IProjectFile | null = null;\n\n\tconstructor(private application: IApplication) {\n\t\t\n\t}\n\n\n\tprivate currentProject: IProject | null = null;\n\tget project() { return this.currentProject; }\n\tset project(value: IProject | null) {\n\t\tthis.currentProject = value;\n\t\tthis.previewFile();\n\t}\n\n\tprivate _currentHtml: IProjectFile | null = null;\n\tget currentHtml() { return this._currentHtml; }\n\n\tpreviewFile(file?: IProjectFile) {\n\t\tExtraLibs.dispose();\n\n\t\tthis._currentHtml = file as IProjectFile;\n\t\tif (file) {\n\t\t\tif (this.currentProject)\n\t\t\t\tthis.currentProject.clearUsed();\n\n\t\t\tconsole.log(\"previewFile\", file.path);\n\t\t\tthis._currentHtml.used = true;\n\t\t\tthis.loadPreview();\n\t\t\tthis.isLoading = true;\n\n\t\t\tdocument.querySelector(\"#previewPanel > .panelHeader > span\")!.textContent = this._currentHtml.name;\n\t\t} else {\n\t\t\tthis.writePreview();\n\t\t}\n\t}\n\n\n\tloadPreview(docked?: boolean) {\n\n\t\tthis.isLoading = false;\n\t\tthis.previousScript = null;\n\t\tconsole.log(\"loadPreview\");\n\n\t\tconst previewContainer = document.getElementById('previewContainer')!;\n\t\tconst consoleContainer = document.getElementById(\"consoleContainer\")!;\n\t\tconsoleContainer.innerHTML = \"\";\n\n\t\tif (docked === void 0)\n\t\t\tdocked = this.isDocked;\n\n\t\t//console.log(\"LOAD PREVIEW\");\n\t\tif (docked) {\n\t\t\tthis.window = null;\n\t\t\tconst previewFrame = <HTMLIFrameElement>document.getElementById(\"previewFrame\")!;\n\t\t\tif (previewFrame)\n\t\t\t\tpreviewFrame.src = _previewPage;\n\t\t\telse\n\t\t\t\tpreviewContainer.innerHTML = '<iframe id=\"previewFrame\" width=\"100%\" height=\"100%\" src=\"' + _previewPage + '\"></iframe>';\n\t\t}\n\t\telse {\n\n\t\t\tconst rect = previewContainer.getBoundingClientRect();\n\t\t\tif (this.isDocked) {\n\t\t\t\tconst pr = window.devicePixelRatio;\n\t\t\t\tthis.window = window.open(_previewPage, \"previewFrame\",\n\t\t\t\t\t\"toolbar=0,status=0,menubar=0,location=0,replace=1\" +\n\t\t\t\t\t\",width=\" + Math.floor(pr * previewContainer.clientWidth) +\n\t\t\t\t\t\",height=\" + Math.floor(pr * previewContainer.clientHeight) +\n\t\t\t\t\t\",left=\" + (window.screenX + Math.floor(pr * rect.left)) +\n\t\t\t\t\t\",top=\" + (window.screenY + Math.floor(pr * rect.top) + 26)\n\t\t\t\t);\n\t\t\t\tconst interval = setInterval(() => {\n\t\t\t\t\tif (!this.window || this.window.closed) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tthis.loadPreview(true);\n\t\t\t\t\t}\n\t\t\t\t}, 250);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.window!.location.href = _previewPage;\n\t\t\t\twindow.focus();\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDocked !== docked) {\n\t\t\tthis.isDocked = docked;\n\t\t\tdocument.body.classList.toggle(\"preview-docked\", docked);\n\t\t\tif (!docked)\n\t\t\t\tpreviewContainer.innerHTML = \"\";\n\t\t\twindow.dispatchEvent(new Event(\"resize\"));\n\t\t\tthis.application.editor && this.application.editor.layout();\n\t\t}\n\t}\n\n\tasync frameLoaded(event: any) {\n\n\t\tif (this.isDocked) {\n\t\t\tconst frame = <HTMLIFrameElement>document.getElementById('previewFrame')!;\n\t\t\tthis.window = frame.contentWindow;\n\t\t}\n\n\t\tif (!this.window) {\n\t\t\tconsole.log(\"WARNING: no previewWindow\");\n\t\t\treturn;\n\t\t}\n\n\t\tloopProtect.alias = \"__protect\";\n\t\t(<any>this.window)['__protect'] = loopProtect.protect;\n\t\tconst sw = this.window.navigator.serviceWorker;\n\n\t\t/*\n\t\twindow.addEventListener('unload', event => {\n\t\t\tconsole.log('UNLOAD', event);\n\t\t\treg.unregister();\n\t\t});\n\t\t*/\n\n\t\tsw.addEventListener('message', this.handleRequest.bind(this));\n\n\t\tvar root = window.location.pathname.substr(0, window.location.pathname.length - 1);\n\n\t\tawait sw.register(root + '/sw.js', { scope: root + \"/assets/v/\" });\n\t\tconsole.log('sw.ready');\n\n\t\tlet reg = sw.ready;\n\t\tconsole.log(\"registered\", reg);\n\n\t\tvar currentHtml = this._currentHtml;\n\t\tif (!currentHtml)\n\t\t\treturn;\n\t\tconst html = await currentHtml.fetchValue();\n\t\tvar base = currentHtml.parent!.path;\n\t\tconsole.log('BASE', base);\n\n\t\tsetTimeout(async () => {\n\t\t\tthis.writePreview(\n\t\t\t\t\"<base href='\" + base + \"'>\"\n\t\t\t\t+ \"<script>(opener||parent).app.preview.onDidLoadPreview(window);</script>\"\n\t\t\t\t+ html);\n\t\t}, 1);\n\n\t\t//console.log('registration failed', err);\n\t}\n\n\tasync handleRequest(event: ServiceWorkerMessageEvent) {\n\n\t\tif (!event.ports || !this.currentProject)\n\t\t\treturn;\n\n\t\tlet blob: Blob | null = null;\n\n\t\tconst originalUrl = event.data as string;\n\t\tconsole.log(\"request: \" + originalUrl);\n\t\tconst originLength = event.origin.length;\n\n\t\tif (originalUrl.substring(0, originLength) === event.origin) {\n\t\t\tlet url = originalUrl.substring(originLength);\n\n\t\t\tlet node = this.currentProject.find(url);\n\t\t\tif (node instanceof ProjectFolder) {\n\t\t\t\tif (!url.endsWith(\"/\")) {\n\t\t\t\t\treturn event.ports[0].postMessage({ redirect: originalUrl + \"/\" });\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(\"TODO: default document\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!node) {\n\t\t\t\ttry {\n\t\t\t\t\tnode = await this.currentProject.loadFile(url);\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\tif (err.status) {\n\t\t\t\t\t\treturn event.ports[0].postMessage({ statusText: err.statusText, status: err.status });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn event.ports[0].postMessage({ statusText: \"not found\", status: 404 });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*\n\t\t\tlet file = this._currentProject.workingDirectory.find(url);\n\t\t\tif (!file) {\n\t\t\t\tfile = await this._currentProject.find(url);\n\t\t\t}\n\t\t\tif (!file) {\n\t\t\t}\n\t\t\t*/\n\t\t\tif (node instanceof ProjectFile) {\n\t\t\t\tvar file = node as IProjectFile;\n\n\t\t\t\tfile.used = true;\n\n\t\t\t\tconst language = file.language;\n\t\t\t\tswitch (language) {\n\t\t\t\t\tcase SourceLanguage.Javascript:\n\t\t\t\t\t\tif (['p5.js', 'p5.dom.js', 'p5.sound.js'].indexOf(file.name) < 0) {\n\t\t\t\t\t\t\tif (this.isLoading)\n\t\t\t\t\t\t\t\tthis.previousScript = file;\n\n\t\t\t\t\t\t\tconst content = await file.fetchValue();\n\n\t\t\t\t\t\t\tif (file !== this.application.currentFile)\n\t\t\t\t\t\t\t\tExtraLibs.add(file.name, content);\n\t\t\t\t\t\t\tblob = new Blob([loopProtect(content)], { type: language && language.mimeType });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!blob)\n\t\t\t\t\tblob = await file.fetchBlob();\n\t\t\t}\n\t\t}\n\t\tevent.ports[0].postMessage(blob);\n\t}\n\n\twritePreview(html?: string) {\n\t\tif (this.window) {\n\t\t\tthis.window.document.open();\n\t\t\tthis.window.document.clear();\n\t\t\tif (html)\n\t\t\t\tthis.window.document.write(html);\n\t\t\tthis.window.document.close();\n\t\t}\n\t}\n\n\tonDidLoadPreview(previewWindow: any) {\n\t\tif (this.isLoading) {\n\t\t\tpreviewWindow.document.addEventListener('DOMContentLoaded', () => {\n\t\t\t\tthis.application.loadFile(this.previousScript || this._currentHtml);\n\t\t\t});\n\t\t}\n\t\tpreviewWindow.addEventListener('error', (error:ErrorEvent) => this.handlePreviewError(error));\n\t\tconst consoleContainer = document.getElementById(\"consoleContainer\")!;\n\t\tnew ProxyConsole(previewWindow.console, row => {\n\t\t\tconst scroll = consoleContainer.scrollTop >= consoleContainer.scrollHeight - consoleContainer.clientHeight - 5;\n\t\t\tconsoleContainer.appendChild(row);\n\t\t\tif (scroll)\n\t\t\t\tconsoleContainer.scrollTop = consoleContainer.scrollHeight - consoleContainer.clientHeight;\n\t\t\t\tthis.setConsoleVisibility();\n\t\t});\n\t}\n\n\thandlePreviewError(event: ErrorEvent) {\n\n\t\tthis.setConsoleVisibility();\n\n\t\tif (this.currentProject) {\n\t\t\tconst consoleContainer = document.getElementById(\"consoleContainer\")!;\n\t\t\tconst control = new PreviewError(this.application, event);\n\t\t\tconsoleContainer.appendChild(control.render());\n\t\t}\n\t}\n\n\tsetConsoleVisibility(show: boolean = true) {\n\t\tconst isVisible = document.body.classList.contains(\"console-visible\");\n\t\tif (isVisible != show) {\n\t\t\tdocument.body.classList.toggle(\"console-visible\", show);\n\t\t\tthis.application.editor.layout();\n\t\t}\n\t}\n\n\n\tupdateFile(file: IProjectFile) {\n\n\t\tif (!this.window)\n\t\t\treturn;\n\n\t\tswitch (file.language) {\n\t\t\tcase SourceLanguage.Css:\n\t\t\t\tconst url = this.window.location.origin + \"/\" + file.path;\n\n\t\t\t\tlet found = false;\n\t\t\t\t(<StyleSheet[]>[]).slice.call(this.window.document.styleSheets)\n\t\t\t\t\t.filter((ss: StyleSheet) => ss.href === url)\n\t\t\t\t\t.forEach((ss: StyleSheet) => {\n\t\t\t\t\t\tconst linkNode = <HTMLLinkElement>ss.ownerNode;\n\t\t\t\t\t\tlinkNode.href = linkNode.href;\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t});\n\n\t\t\t\tif (found)\n\t\t\t\t\treturn;\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tget paused() { return this.isPaused; }\n\tset paused(paused: boolean) {\n\t\tif (this.isPaused !== paused) {\n\t\t\tthis.isPaused = paused;\n\t\t\tif (!paused)\n\t\t\t\tthis.loadPreview();\n\t\t}\n\t}\n}","import { Project, ProjectFile } from \"./project\";\nimport { parseUrl } from \"./utils\";\n\nexport class WebProject extends Project {\n\n\tconstructor(public root: string) {\n\t\tsuper();\n\t}\n\n\tpublic static async load(url: string): Promise<Project> {\n\t\tif (!url)\n\t\t\tthrow new Error(\"invalid Url\");\n\n\t\tlet urlParts = parseUrl(url);\n\t\tif (urlParts.search)\n\t\t\tthrow new Error(\"querystrings not supported\");\n\n\t\tlet branchResponse: Response;\n\n\t\twhile (true) {\n\t\t\tbranchResponse = await fetch(url, {\n\t\t\t\tredirect: \"manual\"\n\t\t\t});\n\n\t\t\tif (branchResponse.type === \"opaqueredirect\") {\n\t\t\t\tlet urlParts2 = parseUrl(branchResponse.url);\n\t\t\t\tif (urlParts2.host !== urlParts.host)\n\t\t\t\t\tthrow new Error(\"insecure host change during redirect\");\n\n\t\t\t\turl = branchResponse.url;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tbreak;\n\t\t}\n\n\t\tlet blob = await branchResponse.blob();\n\n\t\turlParts = parseUrl(branchResponse.url);\n\n\t\tlet path = urlParts.pathname;\n\t\tpath.trimStart(\"/\");\n\t\tpath.trimEnd(\"/\");\n\n\t\tlet project = new WebProject(`${urlParts.protocol}://${urlParts.host}/${path}`);\n\n\t\tif (!path || path.endsWith(\"/\")) {\n\t\t\tpath = path.trimEnd(\"/\");\n\n\t\t\tlet item = new WebFile(\"index.html\", blob);\n\t\t\tproject.addChild(item);\n\t\t}\n\t\telse {\n\t\t\tlet parts = path.split('/');\n\t\t\tlet filename = parts.pop();\n\t\t\tpath = parts.join(\"/\");\n\t\t\tlet item = new WebFile(filename!, blob);\n\t\t\tproject.addChild(item);\n\t\t}\n\t\treturn project;\n\t}\n\n\tasync loadFile(url: string): Promise<ProjectFile | undefined> {\n\n\t\tconsole.log(\"loadFile\", url);\n\t\t//if (url.startsWith(this.path))\n\t\t//\treturn;\n\n\t\tconst response = await fetch(this.root + url);\n\t\tif (!response.ok) \n\t\t\tthrow response;\n\t\tconst blob = await response.blob();\n\n\t\tconst info = this.addParents(url);\n\t\tif (!info)\n\t\t\treturn;\n\n\t\tconst child = new WebFile(info.name, blob);\n\t\tinfo.parent.addChild(child);\n\n\t\t/*\n\t\tconst info = this.addParents(url);\n\t\tif (!info)\n\t\t\treturn;\n\n\t\tconst response = await fetch(this.root + info.parent.path + info.name);\n\t\tconst blob = await response.blob();\n\t\tconsole.log(info.name, blob);\n\n\t\tconst child = new WebFile(info.name, blob);\n\t\tinfo.parent.addChild(child);\n*/\n\t\treturn child;\n\t}\n}\n\nclass WebFile extends ProjectFile {\n\n\tconstructor(path: string, blob: Blob) {\n\t\tsuper(path);\n\n\t\tif (blob)\n\t\t\tthis.blob = blob;\n\t}\n\n\tprotected async fetch(): Promise<Response> {\n\t\treturn await fetch(`${this.project!.path}/${this.path}`);\n\t}\n}\n","/// <reference path=\"project.tsx\"/>\n\nimport { Project, ProjectFile } from \"./project\";\nimport { cachedFetch } from \"./utils\";\n\n\n//https://github.com/processing/p5.js-website/tree/master/src/data/examples\n\nexport class GitHubProject extends Project {\n\n\tconstructor(\n\t\tpublic readonly user: string,\n\t\tpublic readonly repo: string,\n\t\tpublic readonly branch: string,\n\t\tpublic readonly root: string,\n\t\tpublic readonly sha: string) {\n\t\tsuper();\n\t}\n\n\tpublic static async load(url: string): Promise<Project> {\n\n\t\tlet [match, user, repo, branch, path]: string[] = url.match(/(?:https:\\/\\/)?github\\.com\\/([^\\/]*)\\/([^\\/]*)(?:\\/tree\\/([^\\/]*)\\/(.*))?/i) || [];\n\t\tif (!match)\n\t\t\treturn Promise.reject(\"invalid GitHub url\");\n\n\t\tif (!branch)\n\t\t\tbranch = 'master';\n\n\t\tif (!path)\n\t\t\tpath = \"\";\n\n\t\tconst branchResponse = await cachedFetch(`https://api.github.com/repos/${user}/${repo}/branches/${branch || 'master'}`);\n\t\tconst branchJson = await branchResponse.json();\n\n\t\tlet sha = branchJson.commit.sha;\n\t\tconst treeResponse = await cachedFetch(branchJson.commit.commit.tree.url + \"?recursive=1\");\n\t\tconst treeJson = await treeResponse.json() as { tree: [{ path: string, type: string, sha: string }] };\n\n\t\tlet project = new GitHubProject(user, repo, branch, \"/\" + (path || \"\"), sha);\n\n\t\tfor (const item of treeJson.tree.filter(e => e.path.startsWith(path) && e.path.length > path.length && e.type === \"blob\")) {\n\t\t\tproject.addFile(item.path.substr(path.length), item.sha, item.type);\n\t\t}\n\n\t\treturn project;\n\n\t\t/*\n\t\thttps://api.github.com/repos/processing/p5.js-website/git/trees/6e0333b1146068043d55f00295ef80858df7c3ae\n\t\thttps://api.github.com/repos/processing/p5.js-website/git/blobs/e64ba0d13cdfaa5858083f724e2232975d22a25e\n\t\thttps://raw.githubusercontent.com/CodingTrain/Rainbow-Code/cdd39f127bc0d3389c61d78b86e89c251d963c78/README.md\n\t\thttps://cdn.rawgit.com/CodingTrain/Rainbow-Code/cdd39f127bc0d3389c61d78b86e89c251d963c78/README.md\n\t\t*/\n\t}\n\n\taddFile(path: string, sha: string, type: string) {\n\t\tlet info = this.addParents(path);\n\t\tif (info) {\n\t\t\tconst child = new GitHubFile(info.name, sha);\n\t\t\tinfo.parent.addChild(child);\n\t\t}\n\t}\n}\n\n\n\nclass GitHubFile extends ProjectFile {\n\n\tconstructor(name: string, protected readonly sha: string) {\n\t\tsuper(name);\n\t}\n\n\tprotected async fetch(): Promise<Response> {\n\n\t\tlet project = this.project as GitHubProject;\n\t\treturn await fetch(`https://cdn.rawgit.com/${project.user}/${project.repo}/${project.sha}${project.root}/${this.path}`);\n\t}\n}\n","export class Auth {\n\tconstructor() {\n\t}\n\n\tuserName?: string;\n\tauthenticated: boolean = false;\n\n\tasync initialize() {\n\t\tconst token = window.localStorage.access_token;\n\t\tif (token) {\n\t\t\tif (!await this.authenticate(token))\n\t\t\t\twindow.localStorage.access_token = null;\n\t\t}\n\t}\n\n\tasync login() {\n\t\tif (this.authenticated)\n\t\t\treturn;\n\t\tconst token = window.localStorage.access_token = await this.fetchToken();\n\t\tif (token)\n\t\t\tawait this.authenticate(token);\n\t}\n\n\tasync authenticate(token: string) {\n\n\t\tconst userResponse = await fetch(\"https://api.github.com/user\", {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\tAuthorization: \"token \" + token,\n\t\t\t},\n\t\t\tcache: \"no-cache\"\n\t\t});\n\n\t\tconst userJson = await userResponse.json();\n\t\tthis.userName = userJson.login;\n\t\tthis.authenticated = !!this.userName;\n\n\t\tdocument.body.classList.toggle(\"authenticated\", this.authenticated);\n\t\tdocument.getElementById(\"userName\")!.textContent = this.userName || \"\";\n\n\t\treturn this.authenticated;\n\t}\n\n\tlogoff() {\n\t\tdelete window.localStorage.access_token;\n\t\tdelete this.userName;\n\t\tthis.authenticated = false;\n\n\t\tdocument.body.classList.remove(\"authenticated\");\n\t}\n\n\tfetchToken() {\n\n\t\treturn new Promise<string>((resolve, reject) => {\n\n\t\t\tconst params: { [name: string]: any } = {\n\t\t\t\twidth: 450,\n\t\t\t\theight: 600,\n\t\t\t\tmenubar: 0,\n\t\t\t\ttoolbar: 0,\n\t\t\t\tpersonalbar: 0,\n\t\t\t\tstatus: 0,\n\t\t\t\tleft: window.screenLeft + window.innerWidth - 450,\n\t\t\t\ttop: window.screenTop + window.innerHeight - 600,\n\t\t\t};\n\t\t\tconst loginWindow = window.open(\"https://github.com/login/oauth/authorize?scope=public_repo&client_id=2cb7dbbede12e09b2112\", \"_login\", Object.keys(params).map(k => k + '=' + params[k]).join(','))!;\n\n\t\t\twindow.addEventListener(\"message\", onMessage);\n\t\t\tconst interval = setInterval(() => {\n\t\t\t\tif (!loginWindow || loginWindow.closed) {\n\t\t\t\t\tclose();\n\t\t\t\t\treject(\"cancelled\");\n\t\t\t\t}\n\t\t\t}, 250);\n\n\t\t\tfunction close() {\n\t\t\t\tclearInterval(interval);\n\t\t\t\twindow.removeEventListener(\"message\", onMessage);\n\t\t\t\tloginWindow.close();\n\t\t\t}\n\n\t\t\tasync function onMessage(event: MessageEvent) {\n\t\t\t\tconst data = event.data;\n\t\t\t\tconst code: string = data && data.code;\n\t\t\t\tif (code) {\n\n\t\t\t\t\tconst loginResponse = await fetch(\"https://p5ide.codewithoutborders.com/login?code=\" + code, {\n\t\t\t\t\t\tcache: \"no-cache\",\n\t\t\t\t\t});\n\t\t\t\t\tconst loginJson = await loginResponse.text();\n\t\t\t\t\tconst access_token = new URLSearchParams(loginJson).get(\"access_token\");\n\t\t\t\t\tclose();\n\t\t\t\t\tif (access_token)\n\t\t\t\t\t\tresolve(access_token);\n\t\t\t\t\telse\n\t\t\t\t\t\treject(\"failed\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}","import { Project, ProjectFile, ProjectNode } from \"./project\";\nimport { SourceLanguage } from \"./SourceLanguage\";\nimport { P5Editor } from \"./monaco\";\nimport { P5Preview } from \"./preview\";\nimport { click, EventDelayer, promiseRequire, SourceNodeEvent, ExtraLibs } from \"./utils\";\nimport { WebProject } from \"./webProject\";\nimport { GitHubProject } from \"./githubProject\";\nimport { Auth } from \"./auth\";\n\nconst _auth = new Auth();\n\ndeclare global {\n\tinterface Document {\n\t\tready(): Promise<any>;\n\t}\n}\n\nconst libs = [\n\t\"assets/types/index.d.ts\",\n\t\"assets/types/global.d.ts\",\n\t\"https://cdn.rawgit.com/Microsoft/TypeScript/master/lib/lib.es5.d.ts\",\n];\n\nexport class Application implements IApplication {\n\n\tpublic editor!: P5Editor;\n\tpublic preview!: P5Preview;\n\tpublic currentProject!: Project;\n\tpublic currentFile: ProjectFile | null = null;\n\n\tasync loadProjectFromUrl(url: string): Promise<Project> {\n\t\ttry {\n\t\t\treturn await GitHubProject.load(url);\n\t\t}\n\t\tcatch (error) {\n\t\t\treturn await WebProject.load(url);\n\t\t}\n\t}\n\n\t\n\tstatic appendReactChild(parent: Node, child: any) {\n\t\tif (typeof child === \"string\")\n\t\t\tparent.appendChild(document.createTextNode(child));\n\t\telse if (child instanceof ProjectNode)\n\t\t\tparent.appendChild(child.element);\n\t\telse if (child && typeof child['render'] === 'function')\n\t\t\tparent.appendChild(child.render());\n\t\telse if (child instanceof Node)\n\t\t\tparent.appendChild(child);\n\t\telse if (child instanceof Array) {\n\t\t\tfor (const grandChild of child)\n\t\t\t\tApplication.appendReactChild(parent, grandChild);\n\t\t}\n\t\telse if (child !== null && child !== void 0 && typeof child !== 'boolean')\n\t\t\tthrow \"Unsupported child: \" + child;\n\t}\n\n\tloadProject(project: Project) {\n\t\tconsole.log()\n\n\t\tconst fileContainer = document.getElementById(\"fileContainer\")!;\n\t\tfileContainer.innerHTML = \"\";\n\n\t\tif (this.currentProject)\n\t\t\tthis.currentProject.dispose();\n\n\t\tthis.closeFile();\n\n\t\tthis.currentProject = project;\n\t\tthis.preview.project = project;\n\n\t\tconst li = fileContainer.appendChild(project.element);\n\n\t\tli.addEventListener(\"p5ide_openFile\", event => {\n\t\t\tconst sourceEvent = event as SourceNodeEvent;\n\t\t\tthis.loadFile(sourceEvent.sourceNode as ProjectFile);\n\t\t});\n\n\t\tli.addEventListener(\"p5ide_deleteNode\", event => {\n\t\t\tconsole.log(event);\n\t\t});\n\n\t\tconst workingDirectory = project.workingDirectory;\n\n\t\tlet defaultFile = workingDirectory.find(\"index.html\");\n\t\tif (defaultFile) {\n\t\t\tthis.preview.previewFile(defaultFile as ProjectFile);\n\t\t} else {\n\t\t\tdefaultFile = workingDirectory.find(\"README.md\");\n\t\t\tif (defaultFile) {\n\t\t\t\tthis.loadFile(defaultFile as ProjectFile);\n\t\t\t}\n\t\t}\n\t}\n\n\tcloseFile() {\n\n\t\tif (!this.currentFile)\n\t\t\treturn;\n\n\t\tconst model = this.editor.getModel();\n\t\tif (model) {\n\t\t\tif (model != this.currentFile.model)\n\t\t\t\tconsole.log(\"model has changed\");\n\n\t\t\tif (this.currentFile.language === SourceLanguage.Javascript ||\n\t\t\t\tthis.currentFile.language === SourceLanguage.Typescript) {\n\t\t\t\tExtraLibs.add(this.currentFile.name, model.getValue());\n\t\t\t}\n\t\t}\n\n\t\tthis.currentFile.selected = false;\n\t\tthis.currentFile = null;\n\n\t\tthis.preview.currentHtml\n\t}\n\n\tasync loadFile(file: ProjectFile | null, position?: monaco.IPosition) {\n\t\tif (!file)\n\t\t\treturn;\n\n\t\tif (this.currentFile !== file) {\n\n\t\t\tthis.closeFile();\n\n\t\t\tif (file !== this.preview.currentHtml && file.language === SourceLanguage.Html) {\n\n\t\t\t\tthis.currentProject.workingDirectory = file.parent!;\n\t\t\t\tthis.currentProject.walk(f => {\n\t\t\t\t\tif (f.parent)\n\t\t\t\t\t\tf.parent.open = (f.parent === file.parent);\n\t\t\t\t\tf.used = (f === file);\n\t\t\t\t});\n\n\t\t\t\tthis.preview.previewFile(file);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentFile = file;\n\t\t\tthis.currentFile.selected = true;\n\n\t\t\tconst model = await file.fetchModel();\n\t\t\tthis.editor.setModel(model);\n\n\t\t\tExtraLibs.remove(file.name);\n\n\t\t\tdocument.getElementById(\"footerFilename\")!.textContent = file.path;\n\t\t\tdocument.getElementById(\"footerType\")!.textContent = file.languageName || \"plain\";\n\t\t\tdocument.getElementById(\"editorFilename\")!.textContent = file.path;\n\n\t\t\tif (file.parent)\n\t\t\t\tfile.parent.open = true;\n\t\t}\n\n\t\tif (position) {\n\t\t\tthis.editor.setPosition(position);\n\t\t}\n\t}\n\n\n\tasync start() {\n\n\t\tlet values = await Promise.all(libs.map(url => fetch(url).then(response => response.text()).then(text => { return { url: url, text: text }; })));\n\t\tawait document.ready();\n\t\tawait _auth.initialize();\n\n\t\tthis.editor = new P5Editor(values);\n\t\tthis.preview = new P5Preview(this);\n\n\t\tlet project: Project;\n\t\ttry {\n\t\t\tproject = await this.loadProjectFromUrl(location.hash.substring(1));\n\t\t}\n\t\tcatch (err) {\n\t\t\tconsole.log(err);\n\t\t\tproject = await this.loadProjectFromUrl(\"assets/default/\");\n\t\t}\n\n\t\t/*\n\t\tconst optionsDialog = new EditorOptions();\n\t\tconst options = this.editor.options;\n\t\topenDialog(document.body.appendChild(optionsDialog.render(options)));\n\t\t*/\n\n\t\twindow.addEventListener('resize', () => {\n\t\t\tthis.editor.layout();\n\t\t}, true);\n\n\t\tthis.editor.onDidChangeCursorPosition(event => {\n\t\t\tdocument.getElementById(\"footerPosition\")!.textContent = \"Ln \" + event.position.lineNumber + \", Col \" + event.position.column;\n\t\t});\n\n\t\tthis.editor.onDidChangeModel(event => {\n\t\t\tconst model = this.editor.getModel();\n\t\t\tif (this.currentFile!.model === model)\n\t\t\t\treturn;\n\n\t\t\tif (!model) {\n\t\t\t\tthis.closeFile();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst file = this.currentProject.walk(item => (item as ProjectFile).model === model ? item : null);\n\t\t\tif (file)\n\t\t\t\tthis.loadFile(file);\n\t\t\telse {\n\t\t\t\tthis.closeFile();\n\n\t\t\t\tconst path = model.uri.toString();\n\t\t\t\t// TODO: factor\n\t\t\t\tdocument.getElementById(\"footerFilename\")!.textContent = path;\n\t\t\t\tdocument.getElementById(\"footerType\")!.textContent = \"\";\n\t\t\t\tdocument.getElementById(\"editorFilename\")!.textContent = path;\n\n\t\t\t}\n\n\t\n\t\t});\n\n\t\t\n\t\tconst _delayer = new EventDelayer(() => {\n\t\t\tif (this.currentFile)\n\t\t\t\tthis.preview.loadPreview();\n\t\t}, 1000);\n\n\t\t// TODO: fix race condition where file changes before delay triggers\n\t\t// leaving stale changes uncommitted.\n\t\tthis.editor.onDidChangeModelContent(() => {\n\t\t\tif (this.currentFile && this.currentFile.used && !this.preview.paused)\n\t\t\t\t_delayer.trigger();\n\t\t});\t\t\n\n\t\tthis.loadProject(project);\n\n\n\t\tlet pause = (paused: boolean) => {\n\t\t\tdocument.body.classList.toggle(\"preview-paused\", paused);\n\t\t\tthis.preview.paused = paused;\n\t\t};\n\n\t\tclick(\"btnRefresh\", () => { this.preview.loadPreview(); });\n\t\tclick(\"btnPause\", () => { pause(true); });\n\t\tclick(\"btnRun\", () => { pause(false); });\n\t\tclick(\"btnFloatPreview\", () => { this.preview.loadPreview(false); });\n\t\tclick(\"btnCloseConsole\", () => { this.preview.setConsoleVisibility(false); });\n\t\tclick(\"btnLoadProject\", (event) => {\n\t\t\tthis.openDialog(\"#projectOpenDialog\", event.target as HTMLElement);\n\t\t\t//(document.querySelector(\"#openProjectDialgo\") as HTMLElement).style.display = \"block\";\n\t\t});\n\n\t\tclick(\"btnNewFile\", event => this.currentProject.onNewFile(event));\n\t\tclick(\"btnNewFolder\", event => this.currentProject.onNewFolder(event));\n\n\n\t\tclick(\"btnLogin\", async () => {\n\t\t\tawait _auth.login();\n\t\t});\n\n\t\tconst selectTheme = <HTMLSelectElement>document.getElementById(\"selectTheme\");\n\t\tselectTheme.addEventListener('change', () => { setTheme(selectTheme.value); });\n\t\tsetTheme(window.localStorage.theme || selectTheme.value);\n\n\t\tfunction setTheme(theme: string) {\n\t\t\tmonaco.editor.setTheme(theme);\n\t\t\t[].forEach.call(\n\t\t\t\tdocument.querySelectorAll(\"#selectTheme > option\"),\n\t\t\t\t(opt: HTMLOptionElement) => { document.body.classList.remove(\"theme-\" + opt.value); }\n\t\t\t);\n\t\t\tdocument.body.classList.add(\"theme-\" + theme);\n\t\t\twindow.localStorage.theme = theme;\n\t\t\tselectTheme.value = theme;\n\t\t}\n\n\t\t[].forEach.call(document.querySelectorAll(\".flex-horizontal > span, .flex-vertical > span\"), (span: HTMLElement) => {\n\n\t\t\tconst parent = <HTMLElement>span.parentNode;\n\t\t\tconst fixed = parent.querySelector(\":scope > :not(.flex-fill):not(span)\") as HTMLElement;\n\t\t\tconst before = [].find.call(parent.childNodes, (e: Node) => e === fixed || e === span) !== span;\n\t\t\tconst horizontal = parent.classList.contains(\"flex-horizontal\");\n\n\t\t\tspan.addEventListener('mousedown', event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tdocument.addEventListener('mouseup', () => {\n\t\t\t\t\tdocument.removeEventListener('mousemove', onMove);\n\t\t\t\t\tparent.classList.remove(\"dragging\");\n\t\t\t\t});\n\t\t\t\tdocument.addEventListener('mousemove', onMove);\n\t\t\t\tparent.classList.add(\"dragging\");\n\t\t\t});\n\n\t\t\tfunction onMove(event: MouseEvent) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst rect = parent.getBoundingClientRect();\n\t\t\t\tif (horizontal) {\n\t\t\t\t\tconst width = before ? (event.pageX - rect.left) : (rect.right - event.pageX);\n\t\t\t\t\tfixed.style.width = width + \"px\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconst height = before ? (event.pageY - rect.top) : (rect.bottom - event.pageY);\n\t\t\t\t\tfixed.style.height = height + \"px\";\n\t\t\t\t}\n\t\t\t\tfixed.dispatchEvent(new Event(\"resize\"));\n\t\t\t}\n\t\t});\n\n\t\t[].forEach.call(document.body.querySelectorAll(\".dialog\"), (elt: HTMLElement) => {\n\t\t\telt.addEventListener(\"click\", event => {\n\t\t\t\tif (event.target === elt)\n\t\t\t\t\telt.style.display = \"none\";\n\t\t\t});\n\t\t});\n\n\t\tdocument.querySelector(\"#projectOpenDialog\")!.addEventListener(\"submit\", async event => {\n\t\t\tevent.preventDefault();\n\n\t\t\tconst form = event.target as HTMLFormElement;\n\t\t\tconst urlElement = (document.activeElement.tagName === \"BUTTON\" ? document.activeElement : form.elements.namedItem(\"url\")) as HTMLInputElement;\n\n\t\t\ttry {\n\t\t\t\tconst project = await this.loadProjectFromUrl(urlElement.value);\n\t\t\t\tthis.loadProject(project);\n\t\t\t\tform.style.display = \"none\";\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\turlElement.setCustomValidity(\"invalid project URL\");\n\t\t\t\tform.reportValidity();\n\t\t\t}\n\t\t});\n\t}\n\n\n\topenDialog(elt: string | HTMLElement, location ?: HTMLElement) {\n\t\tif (typeof elt === 'string')\n\t\t\telt = document.querySelector(elt) as HTMLElement;\n\t\tlet left = 100, top = 100;\n\t\tif (location) {\n\t\t\tconst rect = location.getBoundingClientRect();\n\t\t\tleft = rect.right;\n\t\t\ttop = rect.bottom;\n\t\t}\n\t\telt.style.paddingLeft = left + \"px\";\n\t\telt.style.paddingTop = top + \"px\";\n\t\telt.style.display = \"block\";\n\n\t\tconst focus = elt.querySelector(\"input[autofocus]\") as HTMLElement;\n\t\tif (focus)\n\t\t\tfocus.focus();\n\t}\n\n}\n"]}