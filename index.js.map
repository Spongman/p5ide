{"version":3,"sources":["SourceLanguage.ts","MyReact.ts","utils.ts","monaco.ts","project.tsx","proxyConsole.ts","error.tsx","preview.ts","webProject.tsx","githubProject.tsx","auth.ts","index.ts"],"names":["SourceLanguage","[object Object]","name","extensions","icon","mimeType","this","extension","charAt","_languages","find","l","indexOf","Javascript","Typescript","Html","Css","exports","MyReact","createElement","tagName","attributes","children","element","document","key","Object","keys","value","startsWith","addEventListener","substr","toLowerCase","setAttribute","child","appendReactChild","promiseRequire","paths","Promise","resolve","reject","require","modules","err","String","prototype","trimStart","str","replace","length","trimEnd","endsWith","click","fn","getElementById","event","preventDefault","cachedFetch","url","window","caches","cache","open","response","match","fetch","put","localStorage","JSON","parse","stringify","EventDelayer","callback","delay","timeUpdate","setTimeout","timeRemaining","Date","now","startTimer","timeNow","searchParams","params","entries","reduce","a","k","v","append","URLSearchParams","parseUrl","href","protocol","hostname","host","port","pathname","hash","search","blobToString","blob","reader","FileReader","e","result","readAsText","ExtraLibs","libName","mapExtraLibs","dispose","content","console","log","disposable","monaco","languages","typescript","javascriptDefaults","addExtraLib","lib","ImmortalReference","object","SimpleModel","model","_onDispose","Emitter","onDispose","textEditorModel","fire","SimpleEditorModelResolverService","editor","resource","Error","getEditorType","EditorType","ICodeEditor","findModel","diffEditor","getOriginalEditor","getModifiedEditor","simpleModel","scheme","provider","getModel","EditorService","_editor","options","sideBySide","path","setModel","selection","setSelection","top","getTopForLineNumber","startLineNumber","domNode","getDomNode","setScrollTop","clientHeight","focus","alert","arguments","P5Editor","libs","fixedOverflowWidgets","fontFamily","lineNumbersMinChars","mouseWheelZoom","scrollBeyondLastLine","theme","setDiagnosticsOptions","noSemanticValidation","noSyntaxValidation","setCompilerOptions","noLib","target","ScriptTarget","ES2016","allowNonTsExtensions","textModelResolverService","editorService","editorContainer","create","textModelService","setEditor","forEach","i","text","createModel","Uri","isUri","origin","layout","getValue","pos","setPosition","newOptions","updateOptions","listener","onDidChangeCursorPosition","onDidChangeModelContent","onDidChangeModel","ProjectNode","parent","_allowClick","renderElement","used","classList","contains","setUsed","toggle","selected","remove","activate","deleteNodeEvent","Event","bubbles","cancelable","sourceNode","dispatchEvent","delete","project","input","querySelector","shaded","readOnly","select","add","$this","onBlur","onChange","isValid","removeEventListener","onInput","style","outlineColor","test","ProjectFolder","childContainer","super","walk","ich","childName","rest","newNode","ProjectFile","addChild","startRename","removeChild","MyReact_1","class","title","onClick","onNewFile","bind","aria-hidden","onNewFolder","onDelete","readonly","clearUsed","push","appendChild","index","splice","Project","cwd","workingDirectory","parts","split","pop","part","childFolder","lastIndexOf","language","SourceLanguage_1","fromExtension","languageName","_languageName","getLanguages","id","Blob","type","utils_1","fetchModel","monaco_1","openFileEvent","ProxyConsole","addRow","_this","prop","getOwnPropertyDescriptors","orig","override","apply","className","args","row","textContent","Array","slice","call","map","toString","join","message","optionalParams","addSimpleRow","PreviewError","app","currentProject","currentTarget","location","local","filename","fileText","lineno","colno","MyReact_2","error","stack","loadFile","lineNumber","column","_previewPage","P5Preview","application","isDocked","isPaused","isLoading","previousScript","_currentHtml","previewFile","currentHtml","file","utils_2","loadPreview","writePreview","docked","previewContainer","innerHTML","previewFrame","src","rect","getBoundingClientRect","pr","devicePixelRatio","Math","floor","clientWidth","screenX","left","screenY","interval","setInterval","closed","clearInterval","body","frame","contentWindow","loopProtect","alias","protect","sw","navigator","serviceWorker","handleRequest","root","register","scope","reg","ready","html","fetchValue","base","__awaiter","ports","originalUrl","data","originLength","substring","node","project_1","postMessage","redirect","status","statusText","SourceLanguage_2","currentFile","fetchBlob","clear","write","close","previewWindow","handlePreviewError","consoleContainer","proxyConsole_1","scroll","scrollTop","scrollHeight","setConsoleVisibility","control","error_1","render","show","found","styleSheets","filter","ss","linkNode","ownerNode","paused","WebProject","project_2","branchResponse","urlParts","utils_3","item","WebFile","ok","info","addParents","GitHubProject","project_3","user","repo","branch","sha","branchJson","utils_4","json","commit","treeJson","tree","addFile","GitHubFile","Auth","authenticated","token","access_token","authenticate","fetchToken","userJson","method","headers","Authorization","userName","login","width","height","menubar","toolbar","personalbar","screenLeft","innerWidth","screenTop","innerHeight","loginWindow","onMessage","code","loginJson","get","_auth","auth_1","Application","githubProject_1","load","webProject_1","createTextNode","project_4","Node","grandChild","fileContainer","closeFile","preview","li","sourceEvent","defaultFile","SourceLanguage_3","utils_5","position","f","values","all","then","initialize","monaco_2","preview_1","loadProjectFromUrl","uri","_delayer","trigger","loadProject","pause","openDialog","selectTheme","setTheme","querySelectorAll","opt","span","parentNode","fixed","before","childNodes","horizontal","onMove","pageX","right","pageY","bottom","elt","display","activeElement","form","urlElement","elements","namedItem","setCustomValidity","reportValidity","paddingLeft","paddingTop"],"mappings":"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","file":"index.js","sourcesContent":["export class SourceLanguage {\n\tconstructor(public name: string, public extensions: string[], public icon: string = \"file-o\", public mimeType: string = \"text/\" + name) { }\n\tstatic Javascript = new SourceLanguage(\"javascript\", [\".js\"], \"file-text-o\");\n\tstatic Typescript = new SourceLanguage(\"typescript\", [\".ts\"], \"file-text-o\");\n\tstatic Html = new SourceLanguage(\"html\", [\".html\"], \"file-code-o\");\n\tstatic Css = new SourceLanguage(\"css\", [\".css\"], \"file-text-o\");\n\tprivate static _languages = [\n\t\tSourceLanguage.Javascript,\n\t\tSourceLanguage.Typescript,\n\t\tSourceLanguage.Html,\n\t\tSourceLanguage.Css,\n\t];\n\tstatic fromExtension(extension: string): SourceLanguage | undefined {\n\t\tif (extension.charAt(0) !== '.')\n\t\t\textension = '.' + extension;\n\t\treturn SourceLanguage._languages.find(l => l.extensions.indexOf(extension) >= 0);\n\t}\n}","\nexport namespace MyReact {\n\n\texport function createElement(tagName: string, attributes: AttributeCollection | null, ...children: any[]): Element {\n\t\tconst element = document.createElement(tagName);\n\n\t\tif (attributes) {\n\t\t\tfor (const key of Object.keys(attributes)) {\n\t\t\t\tconst value = attributes[key];\n\t\t\t\tif (key.startsWith(\"on\") && typeof value === 'function')\n\t\t\t\t\telement.addEventListener(key.substr(2).toLowerCase(), value);\n\t\t\t\telse\n\t\t\t\t\telement.setAttribute(key, value);\n\t\t\t}\n\t\t}\n\n\t\tfor (const child of children)\n\t\t\tappendReactChild(element, child);\n\n\t\treturn element;\n\t}\n}\n","import { ProjectNode } from \"./project\";\n\n\nexport interface Document {\n\tready(): Promise<any>;\n}\n\ninterface Function {\n\tcall<T>(this: (...args: any[]) => T, thisArg: any, ...argArray: any[]): T;\n}\n\n\nexport function promiseRequire(paths: string[]): Promise<any[]> {\n\treturn new Promise((resolve, reject) => {\n\t\trequire(paths, (...modules: any[]) => resolve(modules), (err: RequireError) => reject(err));\n\t});\n}\n\ndeclare interface String {\n\ttrimStart(str?: string): string;\n\ttrimEnd(str?: string): string;\n}\n\ndeclare global {\n\tinterface String {\n\t\ttrimStart(str?: string):string;\n\t\ttrimEnd(str?: string):string;\n\t}\n}\n\nString.prototype.trimStart = function (str?: string) {\n\tif (typeof str === 'undefined')\n\t\treturn this.replace(/^\\s+/, '');\n\tif (this.startsWith(str))\n\t\treturn this.substr(str.length);\n\treturn this as string;\n};\n\nString.prototype.trimEnd = function (str?: string) {\n\tif (typeof str === 'undefined')\n\t\treturn this.replace(/\\s+$/, '');\n\tif (this.endsWith(str))\n\t\treturn this.substr(0, this.length - str.length);\n\treturn this as string;\n};\n/*\nfunction promiseEvent(elt: HTMLElement, type: string): Promise<Event> {\n\treturn new Promise(function (resolve) {\n\t\tfunction handle(event: Event) {\n\t\t\tconsole.log(\"HANDLE\", type);\n\t\t\telt.removeEventListener(type, handle);\n\t\t\tresolve(event);\n\t\t}\n\t\telt.addEventListener(type, handle);\n\t});\n}\n*/\n\nexport function click(element: HTMLElement | string, fn: (event: MouseEvent) => any) {\n\tif (typeof element === 'string')\n\t\telement = document.getElementById(element)!;\n\telement.addEventListener(\"click\", event => {\n\t\tevent.preventDefault();\n\t\tfn(event);\n\t});\n}\n\nexport async function cachedFetch(url: string): Promise<Response> {\n\n\tif (window.caches) {\n\t\tconst cache = await window.caches.open(\"fetch\");\n\t\t//console.log(\"CACHE\", cache);\n\t\tlet response = await cache.match(url);\n\t\t//console.log(\"MATCH\", response);\n\t\tif (!response) {\n\t\t\tresponse = await fetch(url);\n\t\t\t//console.log(\"FETCH\", response);\n\t\t\tawait cache.put(url, response);\n\t\t\tresponse = await cache.match(url);\n\t\t\t//console.log(\"MATCH\", response);\n\t\t}\n\t\treturn response!;\n\t}\n\telse if (window.localStorage) {\n\n\t\tif (!window.localStorage.fetch)\n\t\t\twindow.localStorage.fetch = {};\n\n\t\tlet response: Response = JSON.parse(window.localStorage.fetch[url]);\n\t\tif (!response) {\n\t\t\tresponse = await fetch(url);\n\t\t\twindow.localStorage.fetch[url] = JSON.stringify(response);\n\t\t}\n\t\treturn response;\n\t}\n\telse {\n\t\treturn fetch(url);\n\t}\n}\n\n\nexport class EventDelayer {\n\n\tconstructor(private callback: () => void, private delay: number) {\n\t}\n\n\tprivate timeUpdate: number = 0;\n\n\tprivate startTimer(delay: number) {\n\t\tsetTimeout(() => {\n\n\t\t\tconst timeRemaining = this.timeUpdate - Date.now();\n\t\t\tif (timeRemaining > 0) {\n\t\t\t\tthis.startTimer(timeRemaining);\n\t\t\t} else {\n\t\t\t\tthis.timeUpdate = 0;\n\t\t\t\tthis.callback();\n\t\t\t}\n\n\t\t}, this.delay);\n\t}\n\n\ttrigger() {\n\t\tconst timeNow = Date.now();\n\t\tif (!this.timeUpdate)\n\t\t\tthis.startTimer(this.delay);\n\t\tthis.timeUpdate = timeNow + this.delay;\n\t}\n}\n\nexport interface SourceNodeEvent extends Event {\n\tsourceNode: ProjectNode;\n}\n\nexport function searchParams(params: Object) {\n\treturn Object.entries(params).reduce((a, [k, v]) => { return a.append(k, v), a; }, new URLSearchParams());\n}\n\nexport function parseUrl(url: string) {\n\tconst l = document.createElement(\"a\") as HTMLAnchorElement;\n\tl.href = url;\n\treturn {\n\t\tprotocol: l.protocol.trimEnd(\":\"),\n\t\thostname: l.hostname,\n\t\thost: l.host,\n\t\tport: l.port,\n\t\tpathname: l.pathname.trimStart(\"/\"),\n\t\thash: l.hash,\n\t\tsearch: l.search,\n\t};\n}\n\n\nexport function blobToString(blob: Blob): Promise<string> {\n\treturn new Promise<string>((resolve, reject) => {\n\t\tconst reader = new FileReader();\n\t\treader.addEventListener('loadend', e => resolve(reader.result as string));\n\t\treader.addEventListener('error', reject);\n\t\treader.addEventListener('abort', reject);\n\t\treader.readAsText(blob);\n\t});\n}\n\n\n\nexport class ExtraLibs {\n\n\tprivate static mapExtraLibs: { [name: string]: monaco.IDisposable } = {};\n\n\tpublic static dispose() {\n\t\t//console.log(\"DISPOSE LIBS\", name);\n\t\tfor (const libName in this.mapExtraLibs)\n\t\t\tthis.mapExtraLibs[libName].dispose();\n\t\tthis.mapExtraLibs = {};\n\t}\n\n\tpublic static add(name: string, content: string) {\n\t\tif (this.mapExtraLibs[name])\n\t\t\treturn;\n\t\tconsole.log(\"ADD EXTRA LIB\", name);\n\t\tconst disposable = monaco.languages.typescript.javascriptDefaults.addExtraLib(content, name);\n\t\tthis.mapExtraLibs[name] = disposable;\n\t}\n\n\tpublic static remove(name: string) {\n\t\tconst lib = this.mapExtraLibs[name];\n\t\tif (lib) {\n\t\t\tlib.dispose();\n\t\t\tdelete this.mapExtraLibs[name];\n\t\t}\n\t}\n}","\n\nclass ImmortalReference<T> {\n\tconstructor(public readonly object: T) { }\n\tdispose(): void { }\n}\n\n\nclass SimpleModel {\n\n\tprivate readonly _onDispose: monaco.Emitter<void>;\n\n\tconstructor(private readonly model: monaco.editor.IModel) {\n\t\tthis._onDispose = new monaco.Emitter<void>();\n\t}\n\n\tpublic get onDispose(): monaco.IEvent<void> {\n\t\treturn this._onDispose.event;\n\t}\n\n\tpublic async load(): Promise<SimpleModel> {\n\t\treturn this;\n\t}\n\n\tpublic get textEditorModel(): monaco.editor.IModel {\n\t\treturn this.model;\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._onDispose.fire();\n\t}\n}\n\nclass SimpleEditorModelResolverService {\n\n\tprivate editor: monaco.editor.IEditor | undefined;\n\n\tpublic setEditor(editor: monaco.editor.IEditor): void {\n\t\tthis.editor = editor;\n\t}\n\n\tpublic async createModelReference(resource: monaco.Uri): Promise<ImmortalReference<SimpleModel | null>> {\n\n\t\tif (!this.editor)\n\t\t\tthrow new Error(\"not editor set yet\");\n\n\t\tlet model: monaco.editor.IModel | null;\n\t\tif (this.editor.getEditorType() === monaco.editor.EditorType.ICodeEditor)\n\t\t\tmodel = this.findModel(this.editor, resource);\n\t\telse {\n\t\t\tconst diffEditor = this.editor as monaco.editor.IDiffEditor;\n\t\t\tmodel = this.findModel(diffEditor.getOriginalEditor(), resource) || this.findModel(diffEditor.getModifiedEditor(), resource);\n\t\t}\n\t\tconst simpleModel = model ? new SimpleModel(model) : null;\n\t\treturn new ImmortalReference(simpleModel);\n\t}\n\n\tpublic registerTextModelContentProvider(scheme: string, provider: any): monaco.IDisposable {\n\t\treturn new ImmortalReference(null);\n\t}\n\n\tprivate findModel(editor: monaco.editor.IEditor, resource: monaco.Uri): monaco.editor.IModel {\n\t\t//return editor.getModel(resource);\n\t\treturn editor.getModel() as monaco.editor.IModel;\n\t}\n}\n\nclass EditorService {\n\n\tprivate _editor: monaco.editor.IStandaloneCodeEditor | undefined;\n\n\tsetEditor(editor: monaco.editor.IStandaloneCodeEditor) {\n\t\tthis._editor = editor;\n\t}\n\n\tasync openEditor(options: any, sideBySide: boolean) {\n\t\tconst model = monaco.editor.getModel(options.resource.path);\n\t\tif (!model)\n\t\t\treturn null;\n\t\tif (!this._editor)\n\t\t\tthrow new Error(\"no editor set yet\");\n\t\tthis._editor.setModel(model);\n\t\tif (options.options.selection) {\n\t\t\tthis._editor.setSelection(options.options.selection);\n\t\t\tconst top = this._editor.getTopForLineNumber(options.options.selection.startLineNumber);\n\t\t\tconst domNode = this._editor.getDomNode();\n\t\t\tif (domNode)\n\t\t\t\tthis._editor.setScrollTop(top - domNode.clientHeight * 2 / 5);//.setScrollPosition(200);\n\t\t}\n\t\tthis._editor.focus();\n\t\treturn null;\n\t};\n\n\tresolveEditor() {\n\t\talert(`resolve editor called!` + JSON.stringify(arguments));\n\t}\n}\n\ndeclare interface IPreloadLibrary {\n\ttext: string;\n\turl: string;\n}\n\nexport class P5Editor {\n\n\tpublic _editor: monaco.editor.IStandaloneCodeEditor;\n\tpublic options: monaco.editor.IEditorConstructionOptions = {\n\t\tfixedOverflowWidgets: true,\n\t\tfontFamily: 'Fira Code',\n\t\t//fontLigatures: true,\n\t\t//glyphMargin: false,\n\t\tlineNumbersMinChars: 3,\n\t\tmouseWheelZoom: true,\n\t\tscrollBeyondLastLine: false,\n\t\t//useTabStops: true,\n\t\t//renderIndentGuides: true,\n\t\ttheme: 'vs-dark',\n\t};\n\n\tpublic static parseUrl(url:string):monaco.Uri {\n\t\tif (!monaco.Uri.isUri(url))\n\t\t\turl = window.origin + \"/\" + url;\n\t\treturn monaco.Uri.parse(url);\n\t}\n\n\tconstructor(libs: IPreloadLibrary[]) {\n\n\t\t// validation settings\n\t\tmonaco.languages.typescript.javascriptDefaults.setDiagnosticsOptions({\n\t\t\tnoSemanticValidation: false,\n\t\t\tnoSyntaxValidation: false\n\t\t});\n\n\t\t// compiler options\n\t\tmonaco.languages.typescript.javascriptDefaults.setCompilerOptions({\n\t\t\tnoLib: true,\n\t\t\ttarget: monaco.languages.typescript.ScriptTarget.ES2016,\n\t\t\tallowNonTsExtensions: true\n\t\t});\n\n\t\tconst textModelResolverService = new SimpleEditorModelResolverService();\n\t\tconst editorService = new EditorService();\n\n\n\t\tconst editorContainer = document.getElementById('editorContainer')!;\n\t\tthis._editor = monaco.editor.create(\n\t\t\teditorContainer, this.options, {\n\t\t\t\teditorService: editorService,\n\t\t\t\ttextModelService: textModelResolverService,\n\t\t\t});\n\n\t\ttextModelResolverService.setEditor(this._editor);\n\t\teditorService.setEditor(this._editor);\n\n\n\t\tlibs.forEach((lib, i: number) => {\n\t\t\tconsole.log(\"addExtraLib: \" + lib.url);\n\t\t\tmonaco.languages.typescript.javascriptDefaults.addExtraLib(lib.text, lib.url);\n\t\t});\n\t\tlibs.forEach((lib, i: number) => {\n\t\t\tconst url = P5Editor.parseUrl(lib.url);\n\t\t\t// monaco.Uri.parse(lib.url)\n\t\t\tmonaco.editor.createModel(lib.text, \"typescript\", url);\n\t\t});\n\n\t}\n\n\tlayout() { this._editor.layout(); }\n\tgetValue() { return this._editor.getValue(); }\n\tgetModel() { return this._editor.getModel(); }\n\tsetModel(model: monaco.editor.IModel) { this._editor.setModel(model); }\n\n\tsetPosition(pos: monaco.IPosition) {\n\t\tthis._editor.setPosition(pos);\n\t\tthis._editor.focus();\n\t} \n\tupdateOptions(newOptions: monaco.editor.IEditorOptions) { this._editor.updateOptions(newOptions); }\n\n\tonDidChangeCursorPosition(listener: (e: monaco.editor.ICursorPositionChangedEvent) => void) {\n\t\treturn this._editor.onDidChangeCursorPosition(listener);\n\t}\n\tonDidChangeModelContent(listener: (e: monaco.editor.IModelContentChangedEvent) => void) {\n\t\treturn this._editor.onDidChangeModelContent(listener);\n\t}\n\tonDidChangeModel(listener: (e: monaco.editor.IModelChangedEvent) => void) {\n\t\treturn this._editor.onDidChangeModel(listener);\n\t}\n}","import { SourceLanguage } from \"./SourceLanguage\";\nimport { MyReact } from \"./MyReact\";\nimport { SourceNodeEvent, blobToString } from \"./utils\";\nimport { P5Editor } from \"./monaco\";\n\nexport abstract class ProjectNode implements monaco.IDisposable, IProjectNode {\n\n\tconstructor(public name: string, public icon: string) {\n\t\tthis.element = this.renderElement();\n\t}\n\tparent: ProjectFolder | null = null;\n\treadonly element: HTMLElement;\n\n\tabstract get path(): string;\n\n\tget used(): boolean { return !!this.element && this.element.classList.contains(\"used\"); }\n\tset used(value: boolean) { this.setUsed(value); }\n\n\tclearUsed() { this.used = false }\n\n\tprotected setUsed(value: boolean) {\n\t\tif (value && this.parent)\n\t\t\tthis.parent.used = true;\n\t\tif (this.element)\n\t\t\tthis.element.classList.toggle(\"used\", value);\n\t}\n\n\tget selected(): boolean {\n\t\treturn this.element.classList.contains(\"selected\");\n\t}\n\tset selected(value: boolean) {\n\t\tthis.element.classList.toggle(\"selected\", value);\n\t}\n\n\tprotected abstract renderElement(): HTMLElement;\n\n\tabstract dispose(): void;\n\tdelete() {\n\t\tthis.dispose();\n\t\tif (this.element)\n\t\t\tthis.element.remove();\n\t}\n\n\tprotected _allowClick = true;\n\n\tprotected onClick(event: Event) {\n\t\tevent.preventDefault();\n\t\tif (this._allowClick)\n\t\t\tthis.activate();\n\t}\n\n\tprotected onDelete(event: Event) {\n\t\tevent.preventDefault();\n\n\t\tlet deleteNodeEvent = new Event(\"p5ide_deleteNode\", {\n\t\t\tbubbles: true,\n\t\t\tcancelable: true,\n\t\t}) as SourceNodeEvent;\n\t\tdeleteNodeEvent.sourceNode = this;\n\t\tif (event.target && event.target.dispatchEvent(deleteNodeEvent)) {\n\t\t\tthis.delete();\n\t\t}\n\t}\n\n\tget project(): Project | null { return this.parent && this.parent.project; }\n\n\tabstract activate(): void;\n\n\tasync startRename(): Promise<boolean> {\n\t\tif (!this.project)\n\t\t\tthrow new Error(\"uninitialized\");\n\n\t\tvar input = this.element.querySelector(\".inputWrapper input\") as HTMLInputElement;\n\t\tif (!input)\n\t\t\tthrow new Error(\"input not found\");\n\n\t\tthis._allowClick = false;\n\t\tthis.project.shaded = true;\n\t\tinput.focus();\n\t\tinput.readOnly = false;\n\t\tinput.select();\n\t\tthis.element.classList.add('unshaded');\n\n\t\tvar $this = this;\n\n\t\tvar result = await new Promise<boolean>((resolve, reject) => {\n\n\t\t\tfunction done(value: boolean) {\n\t\t\t\tinput.removeEventListener('blur', onBlur);\n\t\t\t\tinput.removeEventListener('input', onInput);\n\t\t\t\tinput.removeEventListener('change', onChange);\n\t\t\t\tinput.readOnly = true;\n\t\t\t\t$this._allowClick = true;\n\t\t\t\t$this.project!.shaded = false;\n\t\t\t\t$this.element.classList.remove('unshaded');\n\t\t\t\tinput.style.outlineColor = '';\n\t\t\t\tresolve(value);\n\t\t\t}\n\n\t\t\tfunction onBlur(event: Event) {\n\t\t\t\t//done(false);\n\t\t\t}\n\n\t\t\tfunction onChange(event: Event) {\n\t\t\t\tif (isValid()) {\n\t\t\t\t\t$this.name = input.value;\n\t\t\t\t\tdone(true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfunction onInput(event: Event) {\n\t\t\t\tinput.style.outlineColor = isValid() ? '' : 'red';\n\t\t\t}\n\n\t\t\tfunction isValid() {\n\t\t\t\treturn /^[a-z0-9_.-]*$/.test(input.value);\n\t\t\t}\n\n\t\t\tinput.addEventListener('blur', onBlur);\n\t\t\tinput.addEventListener('input', onInput);\n\t\t\tinput.addEventListener('change', onChange);\n\t\t});\n\n\t\treturn result;\n\t}\n}\n\nexport class ProjectFolder extends ProjectNode implements IProjectFolder {\n\n\tconstructor(name: string) {\n\t\tsuper(name, \"folder-o\");\n\n\t\tvar childContainer;\n\t\tif (this.element.classList.contains(\"childContainer\"))\n\t\t\tchildContainer = this.element;\n\t\telse {\n\t\t\tchildContainer= this.element.querySelector(\".childContainer\") as HTMLElement;\n\t\t\tif (!childContainer)\n\t\t\t\tthrow new Error(\"childContainer not found\");\n\t\t}\n\t\tthis.childContainer = childContainer;\n\t}\n\n\treadonly children: ProjectNode[] = [];\n\tprotected childContainer: HTMLElement;\n\n\tget path(): string {\n\t\tlet parentPath = this.parent ? this.parent.path : \"/\";\n\t\treturn parentPath + this.name + \"/\";\n\t}\n\n\tdispose(): void {\n\t\tthis.children.forEach(i => i.dispose());\n\t}\n\n\tdelete() {\n\t\tthis.children.forEach(i => i.delete());\n\t\tsuper.delete();\n\t\tthis.children.length = 0;\n\t}\n\n\twalk(callback:(node:ProjectNode) => any):any {\n\t\tfor (var child of this.children) {\n\t\t\tvar result = callback(child);\n\t\t\tif (result != null)\n\t\t\t\treturn result;\n\t\t\tif (child instanceof ProjectFolder) {\n\t\t\t\tresult = child.walk(callback);\n\t\t\t\tif (result != null)\n\t\t\t\t\treturn result;\n\t\t\t}\n\t\t}\n\t}\n\n\tfind(path: string): ProjectNode | undefined {\n\n\t\tif (!path)\n\t\t\treturn void 0;\n\n\t\tpath = path.trimStart('/');\n\n\t\tlet ich = path.indexOf('/');\n\t\tif (ich < 0)\n\t\t\tich = path.length;\n\n\t\tlet childName = path.substr(0, ich);\n\t\tlet child = (childName === \"..\") ? this.parent : this.children.find(i => i.name === childName) as ProjectFolder;\n\t\tif (!child)\n\t\t\treturn void 0;\n\n\t\tlet rest = path.substr(ich + 1);\n\t\treturn rest ? child.find(rest) : child;\n\t}\n\n\tactivate() {\n\t\tthis.element.classList.toggle(\"open\");\n\t}\n\n\tasync onNewFile(event: Event) {\n\t\tthis.open = true;\n\t\tvar newNode = new ProjectFile('');\n\t\tthis.addChild(newNode);\n\t\tif (await newNode.startRename()) {\n\t\t\tnewNode.activate();\n\t\t} else {\n\t\t\tthis.removeChild(newNode);\n\t\t}\n\t}\n\n\tasync onNewFolder(event: Event) {\n\t\tthis.open = true;\n\t\tvar newNode = new ProjectFolder('');\n\t\tthis.addChild(newNode);\n\t\tif (await newNode.startRename()) {\n\t\t\tnewNode.activate();\n\t\t} else {\n\t\t\tthis.removeChild(newNode);\n\t\t}\n\t}\n\n\trenderElement() {\n\t\treturn (\n\t\t\t<li class=\"sourceNode\">\n\t\t\t\t<div class=\"hover\">\n\t\t\t\t\t<div class=\"hover-show\">\n\t\t\t\t\t\t<a href=\"#\" title=\"new file\" onClick={this.onNewFile.bind(this)} >\n\t\t\t\t\t\t\t<i class=\"fa fa-file-o\" aria-hidden=\"true\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-plus fa-overlay\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a href=\"#\" title=\"new folder\" onClick={this.onNewFolder.bind(this)} >\n\t\t\t\t\t\t\t<i class=\"fa fa-folder-o\" aria-hidden=\"true\">\n\t\t\t\t\t\t\t\t<i class=\"fa fa-plus fa-overlay\" aria-hidden=\"true\"></i>\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t\t<a href=\"#\" title={\"delete \" + this.name} onClick={this.onDelete.bind(this)} >\n\t\t\t\t\t\t\t<i class=\"fa fa-trash-o\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href=\"#\" onClick={this.onClick.bind(this)}>\n\t\t\t\t\t\t<i class=\"icon fa fa-folder-o\"></i>\n\t\t\t\t\t\t<i class=\"icon fa fa-folder-open-o\"></i>\n\t\t\t\t\t\t<div class=\"inputWrapper\">\n\t\t\t\t\t\t\t<input readonly=\"readonly\" value={this.name}></input>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t\t<ul class=\"childContainer\">\n\t\t\t\t\t{this.children}\n\t\t\t\t</ul>\n\t\t\t</li>\n\t\t);\n\t}\n\n\tset used(value: boolean) {\n\t\tsuper.setUsed(value);\n\t\tif (value && this.name !== 'libraries') {\n\t\t\tthis.open = value;\n\t\t}\n\t}\n\n\tclearUsed() {\n\t\tsuper.clearUsed();\n\t\tthis.open = false;\n\t\tfor (var child of this.children)\n\t\t\tchild.clearUsed();\n\t}\n\n\tget open(): boolean {\n\t\treturn this.element.classList.contains(\"open\");\n\t}\n\tset open(value: boolean) {\n\t\tif (this.element)\n\t\t\tthis.element.classList.toggle(\"open\", value);\n\t\tif (value && this.parent)\n\t\t\tthis.parent.open = true;\n\t}\n\n\taddChild(child: ProjectNode) {\n\t\tchild.parent = this;\n\t\tthis.children.push(child);\n\t\tthis.childContainer.appendChild(child.element);\n\t}\n\tremoveChild(child: ProjectNode) {\n\t\tvar index = this.children.indexOf(child);\n\t\tif (index < 0)\n\t\t\tthrow new Error(\"not a child of this node\");\n\t\tchild.parent = null;\n\t\tthis.children.splice(index, 1);\n\t\tif (child.element)\n\t\t\tthis.childContainer.removeChild(child.element);\n\t}\n}\n\n\nexport abstract class Project\n\textends ProjectFolder\n\timplements monaco.IDisposable, IProject {\n\n\tconstructor(cwd: string = \"\") {\n\t\tsuper(\"\");\n\n\t\tthis.workingDirectory = this.find(cwd) as ProjectFolder || this;\n\t}\n\n\trenderElement() {\n\t\treturn (\n\t\t\t<ul class=\"childContainer\">{this.children}</ul>\n\t\t);\n\t}\n\n\tget project() { return this; }\n\tget path() { return \"/\"; }\n\n\tasync loadFile(url: string): Promise<ProjectFile | undefined> { return; }\n\n\tfind(path: string): ProjectNode | undefined {\n\t\tif (this.workingDirectory &&\n\t\t\tthis.workingDirectory !== this &&\n\t\t\t!path.startsWith(\"/\")) {\n\t\t\treturn this.workingDirectory.find(path);\n\t\t}\n\t\treturn super.find(path);\n\t}\n\n\tworkingDirectory: ProjectFolder;\n\n\tprotected addParents(path: string) {\n\n\t\tif (path.startsWith(\"/\")) {\n\t\t\tpath = path.trimStart(\"/\");\n\t\t}\n\t\telse if (path.startsWith(\"./\")) {\n\t\t\tpath = this.workingDirectory.path + path.substr(1);\n\t\t}\n\t\telse if (!path.startsWith(this.path))\n\t\t\treturn;\n\n\t\tlet parent = this as ProjectFolder;\n\t\tlet parts = path.split('/');\n\t\tlet name = parts.pop();\n\t\tif (!name)\n\t\t\treturn;\n\n\t\tfor (let part of parts) {\n\t\t\tlet childFolder = parent.find(part) as ProjectFolder;\n\t\t\tif (!childFolder) {\n\t\t\t\tchildFolder = new ProjectFolder(part);\n\t\t\t\tparent.addChild(childFolder);\n\t\t\t}\n\n\t\t\tparent = childFolder;\n\t\t}\n\n\t\treturn {\n\t\t\tname: name,\n\t\t\tparent: parent,\n\t\t}\n\t}\n\n\tget shaded(): boolean { return this.element.classList.contains(\"shaded\"); }\n\tset shaded(value: boolean) {\n\t\tthis.element.classList.toggle(\"shaded\", value);\n\t}\n}\n\n\nexport class ProjectFile\n\textends ProjectNode\n\timplements IProjectFile {\n\n\tconstructor(name: string) {\n\n\t\tsuper(name, \"file-text-o\");\n\n\t\tconst ich = this.name.lastIndexOf('.');\n\t\tif (ich >= 0)\n\t\t\tthis.extension = this.name.substr(ich);\n\t\telse\n\t\t\tthis.extension = \"\";\n\n\t\tthis.language = SourceLanguage.fromExtension(this.extension);\n\n\t\tif (this.language)\n\t\t\tthis.icon = this.language.icon;\n\t}\n\n\tget path() {\n\t\tlet parentPath = this.parent ? this.parent.path : \"/\";\n\t\treturn parentPath + this.name;\n\t}\n\n\tlanguage?: SourceLanguage;\n\textension: string;\n\n\tprivate _languageName: string | undefined;\n\tget languageName() {\n\t\tif (typeof this._languageName === 'undefined') {\n\t\t\tif (this.language)\n\t\t\t\tthis._languageName = this.language.name;\n\t\t\telse {\n\t\t\t\tlet l = monaco.languages.getLanguages().find(l => l.extensions ? l.extensions.indexOf(this.extension) >= 0 : false);\n\t\t\t\tif (l)\n\t\t\t\t\tthis._languageName = l.id;\n\t\t\t}\n\t\t}\n\t\treturn this._languageName;\n\t}\n\n\tprotected async fetch(): Promise<Response> {\n\t\treturn await fetch(\"assets/default/\" + this.path);\n\t}\n\n\tmodel?: monaco.editor.IModel;\n\tblob?: Blob;\n\n\tasync fetchBlob(): Promise<Blob> {\n\t\tif (this.model)\n\t\t\treturn new Blob([this.model.getValue()], { type: this.language && this.language.mimeType });\n\n\t\tif (!this.blob) {\n\t\t\tlet response = await this.fetch();\n\t\t\tthis.blob = await response.blob();\n\t\t}\n\t\treturn this.blob;\n\t}\n\n\tasync fetchModel(): Promise<monaco.editor.IModel> {\n\n\t\tif (!this.model) {\n\t\t\tlet content: string;\n\t\t\tif (this.blob) {\n\t\t\t\tcontent = await blobToString(this.blob);\n\t\t\t\tdelete this.blob;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tlet response = await this.fetch();\n\t\t\t\tcontent = await response.text();\n\t\t\t}\n\t\t\tthis.model = this.createModel(content);\n\t\t}\n\t\treturn this.model;\n\t}\n\n\tasync fetchValue(): Promise<string> {\n\t\tlet model = await this.fetchModel();\n\t\treturn model.getValue();\n\t}\n\n\t/*\n\tprotected async fetch(): Promise<string> {\n\t\tlet response = await fetch(\"/assets/default/\" + this.path);\n\t\tlet content = await response.text();\n\t\tlet model = this.createModel(content);\n\t\treturn model.getValue();\n\t}\n\t*/\n\n\tprotected createModel(content: string) {\n\t\tif (!this.model)\n\t\t\tthis.model = monaco.editor.createModel(content, this.languageName, P5Editor.parseUrl(this.path));\n\t\treturn this.model;\n\t}\n\n\tdispose(): void {\n\t\tif (this.model) {\n\t\t\tthis.model.dispose();\n\t\t\tdelete this.model;\n\t\t}\n\t}\n\n\tactivate() {\n\t\tlet openFileEvent = new Event(\"p5ide_openFile\", {\n\t\t\tbubbles: true,\n\t\t}) as SourceNodeEvent;\n\t\topenFileEvent.sourceNode = this;\n\t\tthis.element.dispatchEvent(openFileEvent);\n\t}\n\n\trenderElement() {\n\t\treturn (\n\t\t\t<li class=\"sourceNode\">\n\t\t\t\t<div class=\"hover\">\n\t\t\t\t\t<div class=\"hover-show\">\n\t\t\t\t\t\t<a href=\"#\" onClick={this.onDelete.bind(this)} title={\"delete \" + this.name}>\n\t\t\t\t\t\t\t<i class=\"fa fa-trash-o\"></i>\n\t\t\t\t\t\t</a>\n\t\t\t\t\t</div>\n\t\t\t\t\t<a href=\"#\" onClick={this.onClick.bind(this)}>\n\t\t\t\t\t\t<i class={`icon fa fa-${this.icon}`}></i>\n\t\t\t\t\t\t<div class=\"inputWrapper\">\n\t\t\t\t\t\t\t<input readonly=\"readonly\" value={this.name}></input>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</a>\n\t\t\t\t</div>\n\t\t\t</li>\n\t\t);\n\t}\n}\n","export class ProxyConsole {\n\n\tconstructor(console: any, protected addRow: (elt: HTMLElement) => void) {\n\t\tconst _this: any = this;\n\t\tfor (const prop in Object.getOwnPropertyDescriptors(ProxyConsole.prototype)) {\n\t\t\tconst orig: Function = console[prop];\n\t\t\tconst override: Function = _this[prop];\n\t\t\tconsole[prop] = function () {\n\t\t\t\toverride.apply(_this, arguments);\n\t\t\t\torig.apply(this, arguments);\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate addSimpleRow(className: string, args: IArguments) {\n\t\tconst row = document.createElement(\"div\");\n\t\trow.className = className;\n\t\trow.textContent = Array.prototype.slice.call(args).map((a: any) => a.toString()).join(\" \");\n\t\tthis.addRow(row);\n\t}\n\n\t/*\n\tassert(test?: boolean, message?: string, ...optionalParams: any[]): void;\n\tclear(): void;\n\tcount(countTitle?: string): void;\n\tdebug(message?: any, ...optionalParams: any[]): void;\n\t*/\n\tdebug(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-debug\", arguments); }\n\t/*\n\tdir(value?: any, ...optionalParams: any[]): void;\n\tdirxml(value: any): void;\n\tgroup(groupTitle?: string): void;\n\tgroupCollapsed(groupTitle?: string): void;\n\tgroupEnd(): void;\n\tmsIsIndependentlyComposed(element: Element): boolean;\n\tprofile(reportName?: string): void;\n\tprofileEnd(): void;\n\tselect(element: Element): void;\n\ttable(...data: any[]): void;\n\ttime(timerName?: string): void;\n\ttimeEnd(timerName?: string): void;\n\t*/\n\tlog(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-log\", arguments); }\n\tinfo(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-info\", arguments); }\n\twarn(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-warn\", arguments); }\n\t/*\n\ttrace(message?: any, ...optionalParams: any[]): void;\n\t*/\n\terror(message?: any, ...optionalParams: any[]): void { this.addSimpleRow(\"console-error\", arguments); }\n\t/*\n\texception(message?: string, ...optionalParams: any[]): void;\n\t*/\n}\n\n","import { MyReact } from \"./MyReact\";\n\nexport class PreviewError {\n\tproject: IProject;\n\tconstructor(public app:IApplication, public event: ErrorEvent) {\n\t\tthis.project = app.currentProject;\n\t}\n\n\t//private element: HTMLElement;\n\n\trender() {\n\n\t\tlet event = this.event;\n\t\tlet previewWindow = event.currentTarget as Window;\n\t\tconst origin = previewWindow.location.origin;\n\t\tconst local = event.filename.startsWith(origin);\n\t\tlet filename = local ? event.filename.substr(origin.length) : event.filename;\n\t\tfilename = filename.trimStart('/');\n\t\tconst fileText = `${filename}(${event.lineno},${event.colno})`;\n\n\t\tlet onClick = () => {\n\t\t\tthis.app.loadFile(\n\t\t\t\tthis.project.find(filename) as IProjectFile,\n\t\t\t\t{ lineNumber: event.lineno, column: event.colno }\n\t\t\t);\n\t\t\treturn false;\n\t\t};\n\n\t\treturn (\n\t\t\t<div class=\"error\">\n\t\t\t\t{\n\t\t\t\t\tevent.error && event.error.stack &&\n\t\t\t\t\t<i class=\"fa fa-info-circle\" title={event.error.stack}></i>\n\t\t\t\t}\n\t\t\t\t{\n\t\t\t\t\tlocal ?\n\t\t\t\t\t\t<a href=\"#\" onClick={onClick}>{fileText}</a>\n\t\t\t\t\t\t:\n\t\t\t\t\t\t<span>{fileText}</span>\n\t\t\t\t}\n\t\t\t\t<span> : {event.message}</span>\n\t\t\t</div>\n\t\t);\n\t}\n}\n","import { ExtraLibs } from './utils';\nimport { ProxyConsole } from './proxyConsole';\nimport { SourceLanguage } from \"./SourceLanguage\";\nimport { PreviewError } from './error';\nimport { P5Editor } from './monaco';\nimport { ProjectFolder, ProjectFile } from './project';\n\nconst _previewPage = \"assets/v/blank.html\";\n\nexport class P5Preview {\n\n\tprivate window: Window | null = null;\n\tprivate isDocked = true;\n\tprivate isPaused = false;\n\tprivate isLoading = false;\n\n\tprivate previousScript: IProjectFile | null = null;\n\n\tconstructor(private application: IApplication) {\n\t\t\n\t}\n\n\n\tprivate currentProject: IProject | null = null;\n\tget project() { return this.currentProject; }\n\tset project(value: IProject | null) {\n\t\tthis.currentProject = value;\n\t\tthis.previewFile();\n\t}\n\n\tprivate _currentHtml: IProjectFile | null = null;\n\tget currentHtml() { return this._currentHtml; }\n\n\tpreviewFile(file?: IProjectFile) {\n\t\tExtraLibs.dispose();\n\n\t\tthis._currentHtml = file as IProjectFile;\n\t\tif (file) {\n\t\t\tif (this.currentProject)\n\t\t\t\tthis.currentProject.clearUsed();\n\n\t\t\tconsole.log(\"previewFile\", file.path);\n\t\t\tthis._currentHtml.used = true;\n\t\t\tthis.loadPreview();\n\t\t\tthis.isLoading = true;\n\n\t\t\tdocument.querySelector(\"#previewPanel > .panelHeader > span\")!.textContent = this._currentHtml.name;\n\t\t} else {\n\t\t\tthis.writePreview();\n\t\t}\n\t}\n\n\n\tloadPreview(docked?: boolean) {\n\n\t\tthis.isLoading = false;\n\t\tthis.previousScript = null;\n\t\tconsole.log(\"loadPreview\");\n\n\t\tconst previewContainer = document.getElementById('previewContainer')!;\n\t\tconst consoleContainer = document.getElementById(\"consoleContainer\")!;\n\t\tconsoleContainer.innerHTML = \"\";\n\n\t\tif (docked === void 0)\n\t\t\tdocked = this.isDocked;\n\n\t\t//console.log(\"LOAD PREVIEW\");\n\t\tif (docked) {\n\t\t\tthis.window = null;\n\t\t\tconst previewFrame = <HTMLIFrameElement>document.getElementById(\"previewFrame\")!;\n\t\t\tif (previewFrame)\n\t\t\t\tpreviewFrame.src = _previewPage;\n\t\t\telse\n\t\t\t\tpreviewContainer.innerHTML = '<iframe id=\"previewFrame\" width=\"100%\" height=\"100%\" src=\"' + _previewPage + '\"></iframe>';\n\t\t}\n\t\telse {\n\n\t\t\tconst rect = previewContainer.getBoundingClientRect();\n\t\t\tif (this.isDocked) {\n\t\t\t\tconst pr = window.devicePixelRatio;\n\t\t\t\tthis.window = window.open(_previewPage, \"previewFrame\",\n\t\t\t\t\t\"toolbar=0,status=0,menubar=0,location=0,replace=1\" +\n\t\t\t\t\t\",width=\" + Math.floor(pr * previewContainer.clientWidth) +\n\t\t\t\t\t\",height=\" + Math.floor(pr * previewContainer.clientHeight) +\n\t\t\t\t\t\",left=\" + (window.screenX + Math.floor(pr * rect.left)) +\n\t\t\t\t\t\",top=\" + (window.screenY + Math.floor(pr * rect.top) + 26)\n\t\t\t\t);\n\t\t\t\tconst interval = setInterval(() => {\n\t\t\t\t\tif (!this.window || this.window.closed) {\n\t\t\t\t\t\tclearInterval(interval);\n\t\t\t\t\t\tthis.loadPreview(true);\n\t\t\t\t\t}\n\t\t\t\t}, 250);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.window!.location.href = _previewPage;\n\t\t\t\twindow.focus();\n\t\t\t}\n\t\t}\n\n\t\tif (this.isDocked !== docked) {\n\t\t\tthis.isDocked = docked;\n\t\t\tdocument.body.classList.toggle(\"preview-docked\", docked);\n\t\t\tif (!docked)\n\t\t\t\tpreviewContainer.innerHTML = \"\";\n\t\t\twindow.dispatchEvent(new Event(\"resize\"));\n\t\t\tthis.application.editor && this.application.editor.layout();\n\t\t}\n\t}\n\n\tasync frameLoaded(event: any) {\n\n\t\tif (this.isDocked) {\n\t\t\tconst frame = <HTMLIFrameElement>document.getElementById('previewFrame')!;\n\t\t\tthis.window = frame.contentWindow;\n\t\t}\n\n\t\tif (!this.window) {\n\t\t\tconsole.log(\"WARNING: no previewWindow\");\n\t\t\treturn;\n\t\t}\n\n\t\tloopProtect.alias = \"__protect\";\n\t\t(<any>this.window)['__protect'] = loopProtect.protect;\n\t\tconst sw = this.window.navigator.serviceWorker;\n\n\t\t/*\n\t\twindow.addEventListener('unload', event => {\n\t\t\tconsole.log('UNLOAD', event);\n\t\t\treg.unregister();\n\t\t});\n\t\t*/\n\n\t\tsw.addEventListener('message', this.handleRequest.bind(this));\n\n\t\tvar root = window.location.pathname.substr(0, window.location.pathname.length - 1);\n\n\t\tawait sw.register(root + '/sw.js', { scope: root + \"/assets/v/\" });\n\t\tconsole.log('sw.ready');\n\n\t\tlet reg = sw.ready;\n\t\tconsole.log(\"registered\", reg);\n\n\t\tvar currentHtml = this._currentHtml;\n\t\tif (!currentHtml)\n\t\t\treturn;\n\t\tconst html = await currentHtml.fetchValue();\n\t\tvar base = currentHtml.parent!.path;\n\t\tconsole.log('BASE', base);\n\n\t\tsetTimeout(async () => {\n\t\t\tthis.writePreview(\n\t\t\t\t\"<base href='\" + base + \"'>\"\n\t\t\t\t+ \"<script>(opener||parent).app.preview.onDidLoadPreview(window);</script>\"\n\t\t\t\t+ html);\n\t\t}, 1);\n\n\t\t//console.log('registration failed', err);\n\t}\n\n\tasync handleRequest(event: MessageEvent) {\n\n\t\t//ServiceWorkerMessageEvent\n\t\tif (!event.ports || !this.currentProject)\n\t\t\treturn;\n\n\t\tlet blob: Blob | null = null;\n\n\t\tconst originalUrl = event.data as string;\n\t\tconsole.log(\"request: \" + originalUrl);\n\t\tconst originLength = event.origin.length;\n\n\t\tif (originalUrl.substring(0, originLength) === event.origin) {\n\t\t\tlet url = originalUrl.substring(originLength);\n\n\t\t\tlet node = this.currentProject.find(url);\n\t\t\tif (node instanceof ProjectFolder) {\n\t\t\t\tif (!url.endsWith(\"/\")) {\n\t\t\t\t\treturn event.ports[0].postMessage({ redirect: originalUrl + \"/\" });\n\t\t\t\t} else {\n\t\t\t\t\tthrow new Error(\"TODO: default document\");\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!node) {\n\t\t\t\ttry {\n\t\t\t\t\tnode = await this.currentProject.loadFile(url);\n\t\t\t\t}\n\t\t\t\tcatch (err) {\n\t\t\t\t\tif (err.status) {\n\t\t\t\t\t\treturn event.ports[0].postMessage({ statusText: err.statusText, status: err.status });\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!node) {\n\t\t\t\t\treturn event.ports[0].postMessage({ statusText: \"not found\", status: 404 });\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/*\n\t\t\tlet file = this._currentProject.workingDirectory.find(url);\n\t\t\tif (!file) {\n\t\t\t\tfile = await this._currentProject.find(url);\n\t\t\t}\n\t\t\tif (!file) {\n\t\t\t}\n\t\t\t*/\n\t\t\tif (node instanceof ProjectFile) {\n\t\t\t\tvar file = node as IProjectFile;\n\n\t\t\t\tfile.used = true;\n\n\t\t\t\tconst language = file.language;\n\t\t\t\tswitch (language) {\n\t\t\t\t\tcase SourceLanguage.Javascript:\n\t\t\t\t\t\tif (['p5.js', 'p5.dom.js', 'p5.sound.js'].indexOf(file.name) < 0) {\n\t\t\t\t\t\t\tif (this.isLoading)\n\t\t\t\t\t\t\t\tthis.previousScript = file;\n\n\t\t\t\t\t\t\tconst content = await file.fetchValue();\n\n\t\t\t\t\t\t\tif (file !== this.application.currentFile)\n\t\t\t\t\t\t\t\tExtraLibs.add(file.name, content);\n\t\t\t\t\t\t\tblob = new Blob([loopProtect(content)], { type: language && language.mimeType });\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tif (!blob)\n\t\t\t\t\tblob = await file.fetchBlob();\n\t\t\t}\n\t\t}\n\t\tevent.ports[0].postMessage(blob);\n\t}\n\n\twritePreview(html?: string) {\n\t\tif (this.window) {\n\t\t\tthis.window.document.open();\n\t\t\tthis.window.document.clear();\n\t\t\tif (html)\n\t\t\t\tthis.window.document.write(html);\n\t\t\tthis.window.document.close();\n\t\t}\n\t}\n\n\tonDidLoadPreview(previewWindow: any) {\n\t\tif (this.isLoading) {\n\t\t\tpreviewWindow.document.addEventListener('DOMContentLoaded', () => {\n\t\t\t\tthis.application.loadFile(this.previousScript || this._currentHtml);\n\t\t\t});\n\t\t}\n\t\tpreviewWindow.addEventListener('error', (error:ErrorEvent) => this.handlePreviewError(error));\n\t\tconst consoleContainer = document.getElementById(\"consoleContainer\")!;\n\t\tnew ProxyConsole(previewWindow.console, row => {\n\t\t\tconst scroll = consoleContainer.scrollTop >= consoleContainer.scrollHeight - consoleContainer.clientHeight - 5;\n\t\t\tconsoleContainer.appendChild(row);\n\t\t\tif (scroll)\n\t\t\t\tconsoleContainer.scrollTop = consoleContainer.scrollHeight - consoleContainer.clientHeight;\n\t\t\t\tthis.setConsoleVisibility();\n\t\t});\n\t}\n\n\thandlePreviewError(event: ErrorEvent) {\n\n\t\tthis.setConsoleVisibility();\n\n\t\tif (this.currentProject) {\n\t\t\tconst consoleContainer = document.getElementById(\"consoleContainer\")!;\n\t\t\tconst control = new PreviewError(this.application, event);\n\t\t\tconsoleContainer.appendChild(control.render());\n\t\t}\n\t}\n\n\tsetConsoleVisibility(show: boolean = true) {\n\t\tconst isVisible = document.body.classList.contains(\"console-visible\");\n\t\tif (isVisible != show) {\n\t\t\tdocument.body.classList.toggle(\"console-visible\", show);\n\t\t\tthis.application.editor.layout();\n\t\t}\n\t}\n\n\n\tupdateFile(file: IProjectFile) {\n\n\t\tif (!this.window)\n\t\t\treturn;\n\n\t\tswitch (file.language) {\n\t\t\tcase SourceLanguage.Css:\n\t\t\t\tconst url = this.window.location.origin + \"/\" + file.path;\n\n\t\t\t\tlet found = false;\n\t\t\t\t(<StyleSheet[]>[]).slice.call(this.window.document.styleSheets)\n\t\t\t\t\t.filter((ss: StyleSheet) => ss.href === url)\n\t\t\t\t\t.forEach((ss: StyleSheet) => {\n\t\t\t\t\t\tconst linkNode = <HTMLLinkElement>ss.ownerNode;\n\t\t\t\t\t\tlinkNode.href = linkNode.href;\n\t\t\t\t\t\tfound = true;\n\t\t\t\t\t});\n\n\t\t\t\tif (found)\n\t\t\t\t\treturn;\n\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tget paused() { return this.isPaused; }\n\tset paused(paused: boolean) {\n\t\tif (this.isPaused !== paused) {\n\t\t\tthis.isPaused = paused;\n\t\t\tif (!paused)\n\t\t\t\tthis.loadPreview();\n\t\t}\n\t}\n}","import { Project, ProjectFile } from \"./project\";\nimport { parseUrl } from \"./utils\";\n\nexport class WebProject extends Project {\n\n\tconstructor(public root: string) {\n\t\tsuper();\n\t}\n\n\tpublic static async load(url: string): Promise<Project> {\n\t\tif (!url)\n\t\t\tthrow new Error(\"invalid Url\");\n\n\t\tlet urlParts = parseUrl(url);\n\t\tif (urlParts.search)\n\t\t\tthrow new Error(\"querystrings not supported\");\n\n\t\tlet branchResponse: Response;\n\n\t\twhile (true) {\n\t\t\tbranchResponse = await fetch(url, {\n\t\t\t\tredirect: \"manual\"\n\t\t\t});\n\n\t\t\tif (branchResponse.type === \"opaqueredirect\") {\n\t\t\t\tlet urlParts2 = parseUrl(branchResponse.url);\n\t\t\t\tif (urlParts2.host !== urlParts.host)\n\t\t\t\t\tthrow new Error(\"insecure host change during redirect\");\n\n\t\t\t\turl = branchResponse.url;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tbreak;\n\t\t}\n\n\t\tlet blob = await branchResponse.blob();\n\n\t\turlParts = parseUrl(branchResponse.url);\n\n\t\tlet path = urlParts.pathname;\n\t\tpath.trimStart(\"/\");\n\t\tpath.trimEnd(\"/\");\n\n\t\tlet project = new WebProject(`${urlParts.protocol}://${urlParts.host}/${path}`);\n\n\t\tif (!path || path.endsWith(\"/\")) {\n\t\t\tpath = path.trimEnd(\"/\");\n\n\t\t\tlet item = new WebFile(\"index.html\", blob);\n\t\t\tproject.addChild(item);\n\t\t}\n\t\telse {\n\t\t\tlet parts = path.split('/');\n\t\t\tlet filename = parts.pop();\n\t\t\tpath = parts.join(\"/\");\n\t\t\tlet item = new WebFile(filename!, blob);\n\t\t\tproject.addChild(item);\n\t\t}\n\t\treturn project;\n\t}\n\n\tasync loadFile(url: string): Promise<ProjectFile | undefined> {\n\n\t\tconsole.log(\"loadFile\", url);\n\t\t//if (url.startsWith(this.path))\n\t\t//\treturn;\n\n\t\tconst response = await fetch(this.root + url);\n\t\tif (!response.ok) \n\t\t\tthrow response;\n\t\tconst blob = await response.blob();\n\n\t\tconst info = this.addParents(url);\n\t\tif (!info)\n\t\t\treturn;\n\n\t\tconst child = new WebFile(info.name, blob);\n\t\tinfo.parent.addChild(child);\n\n\t\t/*\n\t\tconst info = this.addParents(url);\n\t\tif (!info)\n\t\t\treturn;\n\n\t\tconst response = await fetch(this.root + info.parent.path + info.name);\n\t\tconst blob = await response.blob();\n\t\tconsole.log(info.name, blob);\n\n\t\tconst child = new WebFile(info.name, blob);\n\t\tinfo.parent.addChild(child);\n*/\n\t\treturn child;\n\t}\n}\n\nclass WebFile extends ProjectFile {\n\n\tconstructor(path: string, blob: Blob) {\n\t\tsuper(path);\n\n\t\tif (blob)\n\t\t\tthis.blob = blob;\n\t}\n\n\tprotected async fetch(): Promise<Response> {\n\t\treturn await fetch(`${this.project!.path}/${this.path}`);\n\t}\n}\n","/// <reference path=\"project.tsx\"/>\n\nimport { Project, ProjectFile } from \"./project\";\nimport { cachedFetch } from \"./utils\";\n\n\n//https://github.com/processing/p5.js-website/tree/master/src/data/examples\n\nexport class GitHubProject extends Project {\n\n\tconstructor(\n\t\tpublic readonly user: string,\n\t\tpublic readonly repo: string,\n\t\tpublic readonly branch: string,\n\t\tpublic readonly root: string,\n\t\tpublic readonly sha: string) {\n\t\tsuper();\n\t}\n\n\tpublic static async load(url: string): Promise<Project> {\n\n\t\tlet [match, user, repo, branch, path]: string[] = url.match(/(?:https:\\/\\/)?github\\.com\\/([^\\/]*)\\/([^\\/]*)(?:\\/tree\\/([^\\/]*)\\/(.*))?/i) || [];\n\t\tif (!match)\n\t\t\treturn Promise.reject(\"invalid GitHub url\");\n\n\t\tif (!branch)\n\t\t\tbranch = 'master';\n\n\t\tif (!path)\n\t\t\tpath = \"\";\n\n\t\tconst branchResponse = await cachedFetch(`https://api.github.com/repos/${user}/${repo}/branches/${branch || 'master'}`);\n\t\tconst branchJson = await branchResponse.json();\n\n\t\tlet sha = branchJson.commit.sha;\n\t\tconst treeResponse = await cachedFetch(branchJson.commit.commit.tree.url + \"?recursive=1\");\n\t\tconst treeJson = await treeResponse.json() as { tree: [{ path: string, type: string, sha: string }] };\n\n\t\tlet project = new GitHubProject(user, repo, branch, \"/\" + (path || \"\"), sha);\n\n\t\tfor (const item of treeJson.tree.filter(e => e.path.startsWith(path) && e.path.length > path.length && e.type === \"blob\")) {\n\t\t\tproject.addFile(item.path.substr(path.length), item.sha, item.type);\n\t\t}\n\n\t\treturn project;\n\n\t\t/*\n\t\thttps://api.github.com/repos/processing/p5.js-website/git/trees/6e0333b1146068043d55f00295ef80858df7c3ae\n\t\thttps://api.github.com/repos/processing/p5.js-website/git/blobs/e64ba0d13cdfaa5858083f724e2232975d22a25e\n\t\thttps://raw.githubusercontent.com/CodingTrain/Rainbow-Code/cdd39f127bc0d3389c61d78b86e89c251d963c78/README.md\n\t\thttps://cdn.rawgit.com/CodingTrain/Rainbow-Code/cdd39f127bc0d3389c61d78b86e89c251d963c78/README.md\n\t\t*/\n\t}\n\n\taddFile(path: string, sha: string, type: string) {\n\t\tlet info = this.addParents(path);\n\t\tif (info) {\n\t\t\tconst child = new GitHubFile(info.name, sha);\n\t\t\tinfo.parent.addChild(child);\n\t\t}\n\t}\n}\n\n\n\nclass GitHubFile extends ProjectFile {\n\n\tconstructor(name: string, protected readonly sha: string) {\n\t\tsuper(name);\n\t}\n\n\tprotected async fetch(): Promise<Response> {\n\n\t\tlet project = this.project as GitHubProject;\n\t\treturn await fetch(`https://cdn.rawgit.com/${project.user}/${project.repo}/${project.sha}${project.root}/${this.path}`);\n\t}\n}\n","export class Auth {\n\tconstructor() {\n\t}\n\n\tuserName?: string;\n\tauthenticated: boolean = false;\n\n\tasync initialize() {\n\t\tconst token = window.localStorage.access_token;\n\t\tif (token) {\n\t\t\tif (!await this.authenticate(token))\n\t\t\t\twindow.localStorage.access_token = null;\n\t\t}\n\t}\n\n\tasync login() {\n\t\tif (this.authenticated)\n\t\t\treturn;\n\t\tconst token = window.localStorage.access_token = await this.fetchToken();\n\t\tif (token)\n\t\t\tawait this.authenticate(token);\n\t}\n\n\tasync authenticate(token: string) {\n\n\t\tconst userResponse = await fetch(\"https://api.github.com/user\", {\n\t\t\tmethod: \"GET\",\n\t\t\theaders: {\n\t\t\t\tAuthorization: \"token \" + token,\n\t\t\t},\n\t\t\tcache: \"no-cache\"\n\t\t});\n\n\t\tconst userJson = await userResponse.json();\n\t\tthis.userName = userJson.login;\n\t\tthis.authenticated = !!this.userName;\n\n\t\tdocument.body.classList.toggle(\"authenticated\", this.authenticated);\n\t\tdocument.getElementById(\"userName\")!.textContent = this.userName || \"\";\n\n\t\treturn this.authenticated;\n\t}\n\n\tlogoff() {\n\t\tdelete window.localStorage.access_token;\n\t\tdelete this.userName;\n\t\tthis.authenticated = false;\n\n\t\tdocument.body.classList.remove(\"authenticated\");\n\t}\n\n\tfetchToken() {\n\n\t\treturn new Promise<string>((resolve, reject) => {\n\n\t\t\tconst params: { [name: string]: any } = {\n\t\t\t\twidth: 450,\n\t\t\t\theight: 600,\n\t\t\t\tmenubar: 0,\n\t\t\t\ttoolbar: 0,\n\t\t\t\tpersonalbar: 0,\n\t\t\t\tstatus: 0,\n\t\t\t\tleft: window.screenLeft + window.innerWidth - 450,\n\t\t\t\ttop: window.screenTop + window.innerHeight - 600,\n\t\t\t};\n\t\t\tconst loginWindow = window.open(\"https://github.com/login/oauth/authorize?scope=public_repo&client_id=2cb7dbbede12e09b2112\", \"_login\", Object.keys(params).map(k => k + '=' + params[k]).join(','))!;\n\n\t\t\twindow.addEventListener(\"message\", onMessage);\n\t\t\tconst interval = setInterval(() => {\n\t\t\t\tif (!loginWindow || loginWindow.closed) {\n\t\t\t\t\tclose();\n\t\t\t\t\treject(\"cancelled\");\n\t\t\t\t}\n\t\t\t}, 250);\n\n\t\t\tfunction close() {\n\t\t\t\tclearInterval(interval);\n\t\t\t\twindow.removeEventListener(\"message\", onMessage);\n\t\t\t\tloginWindow.close();\n\t\t\t}\n\n\t\t\tasync function onMessage(event: MessageEvent) {\n\t\t\t\tconst data = event.data;\n\t\t\t\tconst code: string = data && data.code;\n\t\t\t\tif (code) {\n\n\t\t\t\t\tconst loginResponse = await fetch(\"https://p5ide.codewithoutborders.com/login?code=\" + code, {\n\t\t\t\t\t\tcache: \"no-cache\",\n\t\t\t\t\t});\n\t\t\t\t\tconst loginJson = await loginResponse.text();\n\t\t\t\t\tconst access_token = new URLSearchParams(loginJson).get(\"access_token\");\n\t\t\t\t\tclose();\n\t\t\t\t\tif (access_token)\n\t\t\t\t\t\tresolve(access_token);\n\t\t\t\t\telse\n\t\t\t\t\t\treject(\"failed\");\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}","import { Project, ProjectFile, ProjectNode } from \"./project\";\nimport { SourceLanguage } from \"./SourceLanguage\";\nimport { P5Editor } from \"./monaco\";\nimport { P5Preview } from \"./preview\";\nimport { click, EventDelayer, promiseRequire, SourceNodeEvent, ExtraLibs } from \"./utils\";\nimport { WebProject } from \"./webProject\";\nimport { GitHubProject } from \"./githubProject\";\nimport { Auth } from \"./auth\";\n\nconst _auth = new Auth();\n\ndeclare global {\n\tinterface Document {\n\t\tready(): Promise<any>;\n\t}\n}\n\nconst libs = [\n\t\"./assets/types/index.d.ts\",\n\t\"./assets/types/global.d.ts\",\n\t\"https://cdn.rawgit.com/Microsoft/TypeScript/master/lib/lib.es5.d.ts\",\n];\n\nexport class Application implements IApplication {\n\n\tpublic editor!: P5Editor;\n\tpublic preview!: P5Preview;\n\tpublic currentProject!: Project;\n\tpublic currentFile: ProjectFile | null = null;\n\n\tasync loadProjectFromUrl(url: string): Promise<Project> {\n\t\ttry {\n\t\t\treturn await GitHubProject.load(url);\n\t\t}\n\t\tcatch (error) {\n\t\t\treturn await WebProject.load(url);\n\t\t}\n\t}\n\n\t\n\tstatic appendReactChild(parent: Node, child: any) {\n\t\tif (typeof child === \"string\")\n\t\t\tparent.appendChild(document.createTextNode(child));\n\t\telse if (child instanceof ProjectNode)\n\t\t\tparent.appendChild(child.element);\n\t\telse if (child && typeof child['render'] === 'function')\n\t\t\tparent.appendChild(child.render());\n\t\telse if (child instanceof Node)\n\t\t\tparent.appendChild(child);\n\t\telse if (child instanceof Array) {\n\t\t\tfor (const grandChild of child)\n\t\t\t\tApplication.appendReactChild(parent, grandChild);\n\t\t}\n\t\telse if (child !== null && child !== void 0 && typeof child !== 'boolean')\n\t\t\tthrow \"Unsupported child: \" + child;\n\t}\n\n\tloadProject(project: Project) {\n\t\tconsole.log()\n\n\t\tconst fileContainer = document.getElementById(\"fileContainer\")!;\n\t\tfileContainer.innerHTML = \"\";\n\n\t\tif (this.currentProject)\n\t\t\tthis.currentProject.dispose();\n\n\t\tthis.closeFile();\n\n\t\tthis.currentProject = project;\n\t\tthis.preview.project = project;\n\n\t\tconst li = fileContainer.appendChild(project.element);\n\n\t\tli.addEventListener(\"p5ide_openFile\", event => {\n\t\t\tconst sourceEvent = event as SourceNodeEvent;\n\t\t\tthis.loadFile(sourceEvent.sourceNode as ProjectFile);\n\t\t});\n\n\t\tli.addEventListener(\"p5ide_deleteNode\", event => {\n\t\t\tconsole.log(event);\n\t\t});\n\n\t\tconst workingDirectory = project.workingDirectory;\n\n\t\tlet defaultFile = workingDirectory.find(\"index.html\");\n\t\tif (defaultFile) {\n\t\t\tthis.preview.previewFile(defaultFile as ProjectFile);\n\t\t} else {\n\t\t\tdefaultFile = workingDirectory.find(\"README.md\");\n\t\t\tif (defaultFile) {\n\t\t\t\tthis.loadFile(defaultFile as ProjectFile);\n\t\t\t}\n\t\t}\n\t}\n\n\tcloseFile() {\n\n\t\tif (!this.currentFile)\n\t\t\treturn;\n\n\t\tconst model = this.editor.getModel();\n\t\tif (model) {\n\t\t\tif (model != this.currentFile.model)\n\t\t\t\tconsole.log(\"model has changed\");\n\n\t\t\tif (this.currentFile.language === SourceLanguage.Javascript ||\n\t\t\t\tthis.currentFile.language === SourceLanguage.Typescript) {\n\t\t\t\tExtraLibs.add(this.currentFile.name, model.getValue());\n\t\t\t}\n\t\t}\n\n\t\tthis.currentFile.selected = false;\n\t\tthis.currentFile = null;\n\n\t\tthis.preview.currentHtml\n\t}\n\n\tasync loadFile(file: ProjectFile | null, position?: monaco.IPosition) {\n\t\tif (!file)\n\t\t\treturn;\n\n\t\tif (this.currentFile !== file) {\n\n\t\t\tthis.closeFile();\n\n\t\t\tif (file !== this.preview.currentHtml && file.language === SourceLanguage.Html) {\n\n\t\t\t\tthis.currentProject.workingDirectory = file.parent!;\n\t\t\t\tthis.currentProject.walk(f => {\n\t\t\t\t\tif (f.parent)\n\t\t\t\t\t\tf.parent.open = (f.parent === file.parent);\n\t\t\t\t\tf.used = (f === file);\n\t\t\t\t});\n\n\t\t\t\tthis.preview.previewFile(file);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentFile = file;\n\t\t\tthis.currentFile.selected = true;\n\n\t\t\tconst model = await file.fetchModel();\n\t\t\tthis.editor.setModel(model);\n\n\t\t\tExtraLibs.remove(file.name);\n\n\t\t\tdocument.getElementById(\"footerFilename\")!.textContent = file.path;\n\t\t\tdocument.getElementById(\"footerType\")!.textContent = file.languageName || \"plain\";\n\t\t\tdocument.getElementById(\"editorFilename\")!.textContent = file.path;\n\n\t\t\tif (file.parent)\n\t\t\t\tfile.parent.open = true;\n\t\t}\n\n\t\tif (position) {\n\t\t\tthis.editor.setPosition(position);\n\t\t}\n\t}\n\n\n\tasync start() {\n\n\t\tlet values = await Promise.all(libs.map(url => fetch(url).then(response => response.text()).then(text => { return { url: url, text: text }; })));\n\t\tawait document.ready();\n\t\tawait _auth.initialize();\n\n\t\tthis.editor = new P5Editor(values);\n\t\tthis.preview = new P5Preview(this);\n\n\t\tlet project: Project;\n\t\ttry {\n\t\t\tproject = await this.loadProjectFromUrl(location.hash.substring(1));\n\t\t}\n\t\tcatch (err) {\n\t\t\tconsole.log(err);\n\t\t\tproject = await this.loadProjectFromUrl(\"assets/default/\");\n\t\t}\n\n\t\t/*\n\t\tconst optionsDialog = new EditorOptions();\n\t\tconst options = this.editor.options;\n\t\topenDialog(document.body.appendChild(optionsDialog.render(options)));\n\t\t*/\n\n\t\twindow.addEventListener('resize', () => {\n\t\t\tthis.editor.layout();\n\t\t}, true);\n\n\t\tthis.editor.onDidChangeCursorPosition(event => {\n\t\t\tdocument.getElementById(\"footerPosition\")!.textContent = \"Ln \" + event.position.lineNumber + \", Col \" + event.position.column;\n\t\t});\n\n\t\tthis.editor.onDidChangeModel(event => {\n\t\t\tconst model = this.editor.getModel();\n\t\t\tif (this.currentFile!.model === model)\n\t\t\t\treturn;\n\n\t\t\tif (!model) {\n\t\t\t\tthis.closeFile();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst file = this.currentProject.walk(item => (item as ProjectFile).model === model ? item : null);\n\t\t\tif (file)\n\t\t\t\tthis.loadFile(file);\n\t\t\telse {\n\t\t\t\tthis.closeFile();\n\n\t\t\t\tconst path = model.uri.toString();\n\t\t\t\t// TODO: factor\n\t\t\t\tdocument.getElementById(\"footerFilename\")!.textContent = path;\n\t\t\t\tdocument.getElementById(\"footerType\")!.textContent = \"\";\n\t\t\t\tdocument.getElementById(\"editorFilename\")!.textContent = path;\n\n\t\t\t}\n\n\t\n\t\t});\n\n\t\t\n\t\tconst _delayer = new EventDelayer(() => {\n\t\t\tif (this.currentFile)\n\t\t\t\tthis.preview.loadPreview();\n\t\t}, 1000);\n\n\t\t// TODO: fix race condition where file changes before delay triggers\n\t\t// leaving stale changes uncommitted.\n\t\tthis.editor.onDidChangeModelContent(() => {\n\t\t\tif (this.currentFile && this.currentFile.used && !this.preview.paused)\n\t\t\t\t_delayer.trigger();\n\t\t});\t\t\n\n\t\tthis.loadProject(project);\n\n\n\t\tlet pause = (paused: boolean) => {\n\t\t\tdocument.body.classList.toggle(\"preview-paused\", paused);\n\t\t\tthis.preview.paused = paused;\n\t\t};\n\n\t\tclick(\"btnRefresh\", () => { this.preview.loadPreview(); });\n\t\tclick(\"btnPause\", () => { pause(true); });\n\t\tclick(\"btnRun\", () => { pause(false); });\n\t\tclick(\"btnFloatPreview\", () => { this.preview.loadPreview(false); });\n\t\tclick(\"btnCloseConsole\", () => { this.preview.setConsoleVisibility(false); });\n\t\tclick(\"btnLoadProject\", (event) => {\n\t\t\tthis.openDialog(\"#projectOpenDialog\", event.target as HTMLElement);\n\t\t\t//(document.querySelector(\"#openProjectDialgo\") as HTMLElement).style.display = \"block\";\n\t\t});\n\n\t\tclick(\"btnNewFile\", event => this.currentProject.onNewFile(event));\n\t\tclick(\"btnNewFolder\", event => this.currentProject.onNewFolder(event));\n\n\n\t\tclick(\"btnLogin\", async () => {\n\t\t\tawait _auth.login();\n\t\t});\n\n\t\tconst selectTheme = <HTMLSelectElement>document.getElementById(\"selectTheme\");\n\t\tselectTheme.addEventListener('change', () => { setTheme(selectTheme.value); });\n\t\tsetTheme(window.localStorage.theme || selectTheme.value);\n\n\t\tfunction setTheme(theme: string) {\n\t\t\tmonaco.editor.setTheme(theme);\n\t\t\t[].forEach.call(\n\t\t\t\tdocument.querySelectorAll(\"#selectTheme > option\"),\n\t\t\t\t(opt: HTMLOptionElement) => { document.body.classList.remove(\"theme-\" + opt.value); }\n\t\t\t);\n\t\t\tdocument.body.classList.add(\"theme-\" + theme);\n\t\t\twindow.localStorage.theme = theme;\n\t\t\tselectTheme.value = theme;\n\t\t}\n\n\t\t[].forEach.call(document.querySelectorAll(\".flex-horizontal > span, .flex-vertical > span\"), (span: HTMLElement) => {\n\n\t\t\tconst parent = <HTMLElement>span.parentNode;\n\t\t\tconst fixed = parent.querySelector(\":scope > :not(.flex-fill):not(span)\") as HTMLElement;\n\t\t\tconst before = [].find.call(parent.childNodes, (e: Node) => e === fixed || e === span) !== span;\n\t\t\tconst horizontal = parent.classList.contains(\"flex-horizontal\");\n\n\t\t\tspan.addEventListener('mousedown', event => {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tdocument.addEventListener('mouseup', () => {\n\t\t\t\t\tdocument.removeEventListener('mousemove', onMove);\n\t\t\t\t\tparent.classList.remove(\"dragging\");\n\t\t\t\t});\n\t\t\t\tdocument.addEventListener('mousemove', onMove);\n\t\t\t\tparent.classList.add(\"dragging\");\n\t\t\t});\n\n\t\t\tfunction onMove(event: MouseEvent) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\tconst rect = parent.getBoundingClientRect();\n\t\t\t\tif (horizontal) {\n\t\t\t\t\tconst width = before ? (event.pageX - rect.left) : (rect.right - event.pageX);\n\t\t\t\t\tfixed.style.width = width + \"px\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tconst height = before ? (event.pageY - rect.top) : (rect.bottom - event.pageY);\n\t\t\t\t\tfixed.style.height = height + \"px\";\n\t\t\t\t}\n\t\t\t\tfixed.dispatchEvent(new Event(\"resize\"));\n\t\t\t}\n\t\t});\n\n\t\t[].forEach.call(document.body.querySelectorAll(\".dialog\"), (elt: HTMLElement) => {\n\t\t\telt.addEventListener(\"click\", event => {\n\t\t\t\tif (event.target === elt)\n\t\t\t\t\telt.style.display = \"none\";\n\t\t\t});\n\t\t});\n\n\t\tdocument.querySelector(\"#projectOpenDialog\")!.addEventListener(\"submit\", async event => {\n\t\t\tevent.preventDefault();\n\n\t\t\tif (!document.activeElement)\n\t\t\t\treturn;\n\n\t\t\tconst form = event.target as HTMLFormElement;\n\t\t\tconst urlElement = (document.activeElement.tagName === \"BUTTON\" ? document.activeElement : form.elements.namedItem(\"url\")) as HTMLInputElement;\n\n\t\t\ttry {\n\t\t\t\tconst project = await this.loadProjectFromUrl(urlElement.value);\n\t\t\t\tthis.loadProject(project);\n\t\t\t\tform.style.display = \"none\";\n\t\t\t}\n\t\t\tcatch (error) {\n\t\t\t\turlElement.setCustomValidity(\"invalid project URL\");\n\t\t\t\tform.reportValidity();\n\t\t\t}\n\t\t});\n\t}\n\n\n\topenDialog(elt: string | HTMLElement, location ?: HTMLElement) {\n\t\tif (typeof elt === 'string')\n\t\t\telt = document.querySelector(elt) as HTMLElement;\n\t\tlet left = 100, top = 100;\n\t\tif (location) {\n\t\t\tconst rect = location.getBoundingClientRect();\n\t\t\tleft = rect.right;\n\t\t\ttop = rect.bottom;\n\t\t}\n\t\telt.style.paddingLeft = left + \"px\";\n\t\telt.style.paddingTop = top + \"px\";\n\t\telt.style.display = \"block\";\n\n\t\tconst focus = elt.querySelector(\"input[autofocus]\") as HTMLElement;\n\t\tif (focus)\n\t\t\tfocus.focus();\n\t}\n\n}\n"]}